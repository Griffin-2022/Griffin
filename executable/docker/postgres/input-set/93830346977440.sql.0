SET bytea_output TO escape;
;CREATE ROLE regress_lo_user;
;SELECT lo_create(42);
;ALTER LARGE OBJECT 42 OWNER TO regress_lo_user;
;GRANT SELECT ON LARGE OBJECT 42 TO public;
;COMMENT ON LARGE OBJECT 42 IS 'the ultimate answer';
;SELECT oid as "ID",
  pg_catalog.pg_get_userbyid(lomowner) as "Owner",
  pg_catalog.obj_description(oid, 'pg_largeobject') as "Description"
FROM pg_catalog.pg_largeobject_metadata
ORDER BY oid
;SELECT oid as "ID",
  pg_catalog.pg_get_userbyid(lomowner) as "Owner",
  pg_catalog.array_to_string(lomacl, E'\n') AS "Access privileges",
  pg_catalog.obj_description(oid, 'pg_largeobject') as "Description"
FROM pg_catalog.pg_largeobject_metadata
ORDER BY oid
;BEGIN
;select proname, oid from pg_catalog.pg_proc where proname in ('lo_open', 'lo_close', 'lo_creat', 'lo_create', 'lo_unlink', 'lo_lseek', 'lo_lseek64', 'lo_tell', 'lo_tell64', 'lo_truncate', 'lo_truncate64', 'loread', 'lowrite') and pronamespace = (select oid from pg_catalog.pg_namespace where nspname = 'pg_catalog')
;COMMIT
;SELECT oid as "ID",
  pg_catalog.pg_get_userbyid(lomowner) as "Owner",
  pg_catalog.obj_description(oid, 'pg_largeobject') as "Description"
FROM pg_catalog.pg_largeobject_metadata
ORDER BY oid
;CREATE TABLE lotest_stash_values (loid oid, fd integer);
;INSERT INTO lotest_stash_values (loid) SELECT lo_creat(42);
;BEGIN;
;UPDATE lotest_stash_values SET fd = lo_open(loid, CAST(x'20000' | x'40000' AS integer));
;SELECT lowrite(fd, '
I wandered lonely as a cloud
That floats on high o''er vales and hills,
When all at once I saw a crowd,
A host, of golden daffodils;
Beside the lake, beneath the trees,
Fluttering and dancing in the breeze.

Continuous as the stars that shine
And twinkle on the milky way,
They stretched in never-ending line
Along the margin of a bay:
Ten thousand saw I at a glance,
Tossing their heads in sprightly dance.

The waves beside them danced; but they
Out-did the sparkling waves in glee:
A poet could not but be gay,
In such a jocund company:
I gazed--and gazed--but little thought
What wealth the show to me had brought:

For oft, when on my couch I lie
In vacant or in pensive mood,
They flash upon that inward eye
Which is the bliss of solitude;
And then my heart with pleasure fills,
And dances with the daffodils.

         -- William Wordsworth
') FROM lotest_stash_values;
;SELECT lo_close(fd) FROM lotest_stash_values;
;END;
;SELECT lo_from_bytea(0, lo_get(loid)) AS newloid FROM lotest_stash_values
;COMMENT ON LARGE OBJECT 31712 IS 'I Wandered Lonely as a Cloud';
;BEGIN;
;UPDATE lotest_stash_values SET fd=lo_open(loid, CAST(x'20000' | x'40000' AS integer));
;SELECT lo_lseek(fd, 104, 0) FROM lotest_stash_values;
;SELECT loread(fd, 28) FROM lotest_stash_values;
;SELECT lo_lseek(fd, -19, 1) FROM lotest_stash_values;
;SELECT lowrite(fd, 'n') FROM lotest_stash_values;
;SELECT lo_tell(fd) FROM lotest_stash_values;
;SELECT lo_lseek(fd, -744, 2) FROM lotest_stash_values;
;SELECT loread(fd, 28) FROM lotest_stash_values;
;SELECT lo_close(fd) FROM lotest_stash_values;
;END;
;BEGIN;
;SELECT lo_open(loid, x'40000'::int) from lotest_stash_values;
;ABORT;
;DO 'DECLARE loid oid; BEGIN SELECT tbl.loid INTO loid FROM lotest_stash_values tbl; PERFORM lo_export(loid, ''/root/postgres/src/test/regress/results/invalid/path''); EXCEPTION WHEN UNDEFINED_FILE THEN RAISE NOTICE ''could not open file, as expected''; END';
;BEGIN;
;UPDATE lotest_stash_values SET fd=lo_open(loid, CAST(x'20000' | x'40000' AS integer));
;SELECT lo_truncate(fd, 11) FROM lotest_stash_values;
;SELECT loread(fd, 15) FROM lotest_stash_values;
;SELECT lo_truncate(fd, 10000) FROM lotest_stash_values;
;SELECT loread(fd, 10) FROM lotest_stash_values;
;SELECT lo_lseek(fd, 0, 2) FROM lotest_stash_values;
;SELECT lo_tell(fd) FROM lotest_stash_values;
;SELECT lo_truncate(fd, 5000) FROM lotest_stash_values;
;SELECT lo_lseek(fd, 0, 2) FROM lotest_stash_values;
;SELECT lo_tell(fd) FROM lotest_stash_values;
;SELECT lo_close(fd) FROM lotest_stash_values;
;END;
;BEGIN;
;UPDATE lotest_stash_values SET fd = lo_open(loid, CAST(x'20000' | x'40000' AS integer));
;SELECT lo_lseek64(fd, 4294967296, 0) FROM lotest_stash_values;
;SELECT lowrite(fd, 'offset:4GB') FROM lotest_stash_values;
;SELECT lo_tell64(fd) FROM lotest_stash_values;
;SELECT lo_lseek64(fd, -10, 1) FROM lotest_stash_values;
;SELECT lo_tell64(fd) FROM lotest_stash_values;
;SELECT loread(fd, 10) FROM lotest_stash_values;
;SELECT lo_truncate64(fd, 5000000000) FROM lotest_stash_values;
;SELECT lo_lseek64(fd, 0, 2) FROM lotest_stash_values;
;SELECT lo_tell64(fd) FROM lotest_stash_values;
;SELECT lo_truncate64(fd, 3000000000) FROM lotest_stash_values;
;SELECT lo_lseek64(fd, 0, 2) FROM lotest_stash_values;
;SELECT lo_tell64(fd) FROM lotest_stash_values;
;SELECT lo_close(fd) FROM lotest_stash_values;
;END;
;SELECT lo_unlink(loid) from lotest_stash_values;
;TRUNCATE lotest_stash_values;
;INSERT INTO lotest_stash_values (loid) SELECT lo_import('/root/postgres/src/test/regress/data/tenk.data');
;BEGIN;
;UPDATE lotest_stash_values SET fd=lo_open(loid, CAST(x'20000' | x'40000' AS integer));
;SELECT lo_lseek(fd, 0, 2) FROM lotest_stash_values;
;SELECT lo_lseek(fd, 2030, 0) FROM lotest_stash_values;
;SELECT loread(fd, 36) FROM lotest_stash_values;
;SELECT lo_tell(fd) FROM lotest_stash_values;
;SELECT lo_lseek(fd, -26, 1) FROM lotest_stash_values;
;SELECT lowrite(fd, 'abcdefghijklmnop') FROM lotest_stash_values;
;SELECT lo_lseek(fd, 2030, 0) FROM lotest_stash_values;
;SELECT loread(fd, 36) FROM lotest_stash_values;
;SELECT lo_close(fd) FROM lotest_stash_values;
;END;
;SELECT lo_export(loid, '/root/postgres/src/test/regress/results/lotest.txt') FROM lotest_stash_values;
;BEGIN
;COMMIT
;BEGIN
;COMMIT
;SELECT pageno, data FROM pg_largeobject WHERE loid = (SELECT loid from lotest_stash_values)
EXCEPT
SELECT pageno, data FROM pg_largeobject WHERE loid = 32501;
;SELECT lo_unlink(loid) FROM lotest_stash_values;
;TRUNCATE lotest_stash_values;
;BEGIN
;COMMIT
;BEGIN
;COMMIT
;SELECT lo_from_bytea(0, lo_get(32989)) AS newloid_2
;SELECT md5(lo_get(32989)) = md5(lo_get(33326));
;SELECT lo_get(32989, 0, 20);
;SELECT lo_get(32989, 10, 20);
;SELECT lo_put(32989, 5, decode('afafafaf', 'hex'));
;SELECT lo_get(32989, 0, 20);
;SELECT lo_put(32989, 4294967310, 'foo');
;SELECT lo_get(32989);
;SELECT lo_get(32989, 4294967294, 100);
;BEGIN
;COMMIT
;BEGIN
;COMMIT
;SELECT lo_from_bytea(0, E'\\xdeadbeef') AS newloid
;SET bytea_output TO hex;
;SELECT lo_get(33569);
;SELECT lo_create(2121);
;COMMENT ON LARGE OBJECT 2121 IS 'testing comments';
;DROP TABLE lotest_stash_values;
;DROP ROLE regress_lo_user;
;