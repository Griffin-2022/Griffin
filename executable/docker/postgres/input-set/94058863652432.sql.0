
  CREATE TABLE test (
    key   integer UNIQUE,
    val   text
  );

  CREATE OR REPLACE FUNCTION insert_unique(k integer, v text) RETURNS void
  LANGUAGE SQL AS $$
    INSERT INTO test (key, val) SELECT k, v WHERE NOT EXISTS (SELECT key FROM test WHERE key = k);
  $$;

;
  DROP FUNCTION insert_unique(integer, text);
  DROP TABLE test;

;