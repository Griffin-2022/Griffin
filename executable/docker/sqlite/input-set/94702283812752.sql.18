SELECT * FROM v1

;SELECT * FROM v2

;CREATE TABLE t4(x, y);
;INSERT INTO t4 VALUES(1, 'g');
;INSERT INTO t4 VALUES(2, 'i');
;INSERT INTO t4 VALUES(3, 'l');
;INSERT INTO t4 VALUES(4, 'g');
;INSERT INTO t4 VALUES(5, 'a');
;CREATE TABLE t5(x, y, m);
;CREATE TRIGGER t4i AFTER INSERT ON t4 BEGIN
    DELETE FROM t5;
    INSERT INTO t5 
      SELECT x, y, max(y) OVER xyz FROM t4
      WINDOW xyz AS (PARTITION BY (x%2) ORDER BY x);
  END;
;
;SELECT x, y, max(y) OVER xyz FROM t4
      WINDOW xyz AS (PARTITION BY (x%2) ORDER BY x) ORDER BY 1

;INSERT INTO t4 VALUES(6, 'm');
;SELECT * FROM t5 ORDER BY 1

;WITH aaa(x, y, z) AS (
    SELECT x, y, max(y) OVER xyz FROM t4
    WINDOW xyz AS (PARTITION BY (x%2) ORDER BY x)
  )
  SELECT * FROM aaa ORDER BY 1;
;
;WITH aaa(x, y, z) AS (
    SELECT x, y, max(y) OVER xyz FROM t4
    WINDOW xyz AS (ORDER BY x)
  )
  SELECT *, min(z) OVER (ORDER BY x) FROM aaa ORDER BY 1;
;
;-- 2021-04-17 dbsqlfuzz d9cf66100064952b66951845dfab41de1c124611
  DROP TABLE IF EXISTS t1;
;CREATE TABLE t1(a,b,c,d);
;DROP TABLE IF EXISTS t2;
;CREATE TABLE t2(x,y);
;CREATE TRIGGER r1 AFTER INSERT ON t1 BEGIN
    INSERT INTO t2(x,y)
      SELECT a, max(d) OVER w1 FROM t1
        WINDOW w1 AS (PARTITION BY EXISTS(SELECT 1 FROM t1 WHERE c=?1) );
  END;
;CREATE TRIGGER r1 AFTER INSERT ON t1 BEGIN
    INSERT INTO t1(a,b) 
        SELECT a, max(d) OVER w1 FROM t1
        WINDOW w1 AS (
          ORDER BY a ROWS BETWEEN ? PRECEDING AND UNBOUNDED FOLLOWING
        );
  END;
;CREATE TRIGGER r1 AFTER INSERT ON t1 BEGIN
    INSERT INTO t1(a,b) 
        SELECT a, max(d) OVER w1 FROM t1
        WINDOW w1 AS (
          ORDER BY a ROWS BETWEEN UNBOUNDED PRECEDING AND ? FOLLOWING
        );
  END;
;CREATE TABLE sales(emp TEXT PRIMARY KEY, region, total);
;INSERT INTO sales VALUES
      ('Alice',     'North', 34),
      ('Frank',     'South', 22),
      ('Charles',   'North', 45),
      ('Darrell',   'South', 8),
      ('Grant',     'South', 23),
      ('Brad' ,     'North', 22),
      ('Elizabeth', 'South', 99),
      ('Horace',    'East',   1);
;
;SELECT emp, region, total FROM (
    SELECT 
      emp, region, total,
      row_number() OVER (PARTITION BY region ORDER BY total DESC) AS rank
    FROM sales
  ) WHERE rank<=2 ORDER BY region, total DESC

;SELECT emp, region, sum(total) OVER win FROM sales
  WINDOW win AS (PARTITION BY region ORDER BY total)

;SELECT emp, region, sum(total) OVER win FROM sales
  WINDOW win AS (PARTITION BY region ORDER BY total)
  LIMIT 5

;SELECT emp, region, sum(total) OVER win FROM sales
  WINDOW win AS (PARTITION BY region ORDER BY total)
  LIMIT 5 OFFSET 2

;SELECT emp, region, sum(total) OVER win FROM sales
  WINDOW win AS (
    PARTITION BY region ORDER BY total 
    ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING
  )

;SELECT emp, region, sum(total) OVER win FROM sales
  WINDOW win AS (
    PARTITION BY region ORDER BY total 
    ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING
  ) LIMIT 5 OFFSET 2

;SELECT emp, region, (
    SELECT sum(total) OVER (
      ORDER BY total RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
    ) || outer.emp FROM sales
  ) FROM sales AS outer;
;
;SELECT emp, region, (
    SELECT sum(total) FILTER (WHERE sales.emp!=outer.emp) OVER (
      ORDER BY total RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
    ) FROM sales
  ) FROM sales AS outer;
;
;CREATE TABLE t6(a, b, c);
;
;CREATE INDEX t6i ON t6(a) WHERE sum(b) OVER ();
;CREATE INDEX t6i ON t6(a) WHERE lead(b) OVER ();
;CREATE INDEX t6i ON t6(sum(b) OVER ());
;CREATE INDEX t6i ON t6(lead(b) OVER ());
;DROP TABLE IF EXISTS t1;
;CREATE TABLE t1(id INT, b VARCHAR, c VARCHAR);
;INSERT INTO t1 VALUES(1, 'A', 'one');
;INSERT INTO t1 VALUES(2, 'B', 'two');
;INSERT INTO t1 VALUES(3, 'C', 'three');
;INSERT INTO t1 VALUES(4, 'D', 'one');
;INSERT INTO t1 VALUES(5, 'E', 'two');
;SELECT id, b, lead(c,1) OVER(ORDER BY c) AS x 
    FROM t1 WHERE id>1
   ORDER BY b LIMIT 1;
;
;INSERT INTO t1 VALUES(6, 'F', 'three');
;INSERT INTO t1 VALUES(7, 'G', 'one');
;SELECT id, b, lead(c,1) OVER(ORDER BY c) AS x
    FROM t1 WHERE id>1
   ORDER BY b LIMIT 2;
;
;DROP TABLE IF EXISTS t1;
;CREATE TABLE t1(a int, b int);
;INSERT INTO t1 VALUES(1,11);
;INSERT INTO t1 VALUES(2,12);
;
;SELECT a, rank() OVER(ORDER BY b) FROM t1;
;SELECT a, rank() OVER(ORDER BY b DESC) FROM t1;
;
;SELECT a, rank() OVER(ORDER BY b) FROM t1
    UNION ALL
  SELECT a, rank() OVER(ORDER BY b DESC) FROM t1;
;
;SELECT a, rank() OVER(ORDER BY b) FROM t1
    UNION 
  SELECT a, rank() OVER(ORDER BY b DESC) FROM t1;
;
;SELECT a, rank() OVER(ORDER BY b) FROM t1
    EXCEPT 
  SELECT a, rank() OVER(ORDER BY b DESC) FROM t1;
;
;SELECT a, rank() OVER(ORDER BY b) FROM t1
    INTERSECT 
  SELECT a, rank() OVER(ORDER BY b DESC) FROM t1;
;
;