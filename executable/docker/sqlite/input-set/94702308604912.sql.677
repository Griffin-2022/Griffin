CREATE VIRTUAL TABLE temp.x1 USING zipfile('test.zip');
;SELECT*FROM"temp".sqlite_master WHERE name='x1' AND sql='CREATE VIRTUAL TABLE x1 USING zipfile(''test.zip'')' ORDER BY rowid
;SELECT*FROM"temp".sqlite_master WHERE name='x1' AND sql='CREATE VIRTUAL TABLE x1 USING zipfile(''test.zip'')' ORDER BY rowid
;INSERT INTO x1(name, data) VALUES('dir1/', NULL);
;INSERT INTO x1(name, data) VALUES('file1', '1234');
;INSERT INTO x1(name, data) VALUES('dir1/file2', '5678');
;
;INSERT INTO x1(name, data) VALUES($fname, NULL);
;INSERT INTO x1(name, data) VALUES($fname || '/', NULL);
;INSERT INTO x1(name, data) VALUES($fname, 'abcd');
;INSERT INTO x1(name, data) VALUES($fname, NULL);
;INSERT INTO x1(name, data) VALUES($fname || '/', NULL);
;INSERT INTO x1(name, data) VALUES($fname, 'abcd');
;INSERT INTO x1(name, data) VALUES($fname, NULL);
;INSERT INTO x1(name, data) VALUES($fname || '/', NULL);
;INSERT INTO x1(name, data) VALUES($fname, 'abcd');
;SELECT rowid FROM x1

;CREATE VIRTUAL TABLE yyy USING zipfile();
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;CREATE VIRTUAL TABLE yyy USING zipfile('test.zip', 'test.zip');
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;SELECT * FROM zipfile()

;SELECT * FROM zipfile('/path/that/does/not/exist')

;WITH m(m) AS ( SELECT $mode)
    SELECT zipfile('a.txt', m, 1000, 'xyz') FROM m
  
;WITH m(m) AS ( SELECT $mode)
    SELECT zipfile('a.txt', m, 1000, 'xyz') FROM m
  
;WITH m(m) AS ( SELECT $mode)
    SELECT zipfile('a.txt', m, 1000, 'xyz') FROM m
  
;WITH c(name,data) AS ( SELECT 'a.txt', 'abc')
  SELECT zipfile(name) FROM c

;WITH c(name,data) AS ( 
    SELECT 'a.txt', 'abc' UNION ALL
    SELECT NULL, 'def'
  )
  SELECT zipfile(name,data) FROM c

;WITH c(name,data,method) AS ( 
    SELECT 'a.txt', 'abc', 0
    UNION SELECT 'b.txt', 'def', 8
    UNION SELECT 'c.txt', 'ghi', 16
  )
  SELECT zipfile(name,NULL,NULL,data,method) FROM c

;WITH c(name,data) AS ( 
    SELECT 'a.txt', 'abc'
    UNION SELECT 'b.txt', 'def'
    UNION SELECT 'c.txt/', 'ghi'
  )
  SELECT zipfile(name,NULL,NULL,data) FROM c

;WITH c(name,mtime,data) AS (
    SELECT 'a.txt', 946684800, 'abc'
  )
  SELECT name,mtime,data FROM zipfile(
    ( SELECT rt( zipfile(name,NULL,mtime,data,NULL) ) FROM c )
  )

;WITH c(name,mtime,data) AS (
        SELECT 'a.txt', 946684800, 'abc' UNION ALL
        SELECT 'b.txt', 1000000000, 'abc' UNION ALL
        SELECT 'c.txt', 1111111000, 'abc'
      )
      SELECT writefile('test1.zip', rt( zipfile(name, NULL, mtime, data) ) ),
             writefile('test2.zip',   ( zipfile(name, NULL, mtime, data) ) ) 
      FROM c;
;
;SELECT name, strftime('%s', mtime, 'unixepoch', 'localtime') 
      FROM fsdir('test_unzip') WHERE name!='test_unzip'
      ORDER BY name
    
;SELECT sum(name LIKE '%/a.txt')
      FROM (VALUES(1),(2),(3)) CROSS JOIN fsdir('test_unzip')
    
;SELECT name, mtime, data FROM zipfile('test1.zip')
  
;SELECT name, mtime 
      FROM fsdir('test_unzip') WHERE name!='test_unzip'
      ORDER BY name
    
;SELECT name, mtime, sz, rawdata, data FROM zipfile('test2.zip')
  
;WITH c(name,data) AS (
        SELECT '1', randomblob(1000000) UNION ALL
        SELECT '2', randomblob(1000000) UNION ALL
        SELECT '3', randomblob(1000000) 
    )
    SELECT writefile('test.zip', zipfile(name, data) ) FROM c;
;
;SELECT name, data FROM zipfile('test.zip') 
;CREATE VIRTUAL TABLE zz USING zipfile('test.zip');
;BEGIN;
;INSERT INTO zz(name, data) VALUES('a.txt', '1');
;INSERT INTO zz(name, data) VALUES('b.txt', '2');
;INSERT INTO zz(name, data) VALUES('c.txt', '1');
;INSERT INTO zz(name, data) VALUES('d.txt', '2');
;SELECT name, data FROM zz;
;
;SELECT name, data FROM zz 
;DELETE FROM zz WHERE name=$name 
;COMMIT
;CREATE VIRTUAL TABLE nogood USING zipfile('test_unzip');
;
;INSERT INTO nogood(name, data) VALUES('abc', 'def');
;DROP TABLE nogood;
;BEGIN;
;
;INSERT INTO nogood(name, data) VALUES('abc', 'def');
;COMMIT;
;
;CREATE VIRTUAL TABLE ok USING zipfile('test.zip');
;INSERT INTO ok(name, data) VALUES ('sqlite3', 'elf');
;COMMIT;
;
;WITH src(nm) AS (
    VALUES('dir1') UNION ALL
    VALUES('dir2/') UNION ALL
    VALUES('dir3//') UNION ALL
    VALUES('dir4///') UNION ALL
    VALUES('/') 
  )
  SELECT name FROM zipfile((SELECT zipfile(nm, NULL) FROM src))

;