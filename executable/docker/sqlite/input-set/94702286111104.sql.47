SAVEPOINT _tcl_transaction
;SAVEPOINT _tcl_transaction
;PRAGMA page_size = 1024;
;
;CREATE TABLE t1(a PRIMARY KEY, b UNIQUE);
;INSERT INTO t1 VALUES(1, randomblob(400));
;INSERT INTO t1 SELECT a+1,  randomblob(400) FROM t1;
;INSERT INTO t1 SELECT a+2,  randomblob(400) FROM t1;
;INSERT INTO t1 SELECT a+4,  randomblob(400) FROM t1;
;INSERT INTO t1 SELECT a+8,  randomblob(400) FROM t1;
;INSERT INTO t1 SELECT a+16, randomblob(400) FROM t1;
;INSERT INTO t1 SELECT a+32, randomblob(400) FROM t1;
;INSERT INTO t1 SELECT a+64, randomblob(400) FROM t1;
;CREATE TABLE t2(a PRIMARY KEY, b UNIQUE);
;INSERT INTO t2 SELECT * FROM t1;
;
;COMMIT
;COMMIT
;DELETE FROM t1 WHERE a%2;
;INSERT INTO t1 SELECT b, a FROM t2 WHERE a%2;
;UPDATE t1 SET b=randomblob(600) WHERE (a%2)==0;
;
;CREATE VIRTUAL TABLE temp.stat USING dbstat 
;SELECT*FROM"temp".sqlite_master WHERE name='stat' AND sql='CREATE VIRTUAL TABLE stat USING dbstat' ORDER BY rowid
;SELECT*FROM"temp".sqlite_master WHERE name='stat' AND sql='CREATE VIRTUAL TABLE stat USING dbstat' ORDER BY rowid
;SELECT pageno FROM stat WHERE name = 't1' ORDER BY pageno
;SELECT * FROM (SELECT 'sqlite_schema' AS name,1 AS rootpage,'table' AS type UNION ALL SELECT name,rootpage,type FROM "main".sqlite_schema WHERE rootpage!=0)WHERE name='t1'
;DROP TABLE temp.stat 
;SELECT*FROM"temp".sqlite_master WHERE name='stat' AND sql='CREATE VIRTUAL TABLE stat USING dbstat' ORDER BY rowid
;SELECT*FROM"temp".sqlite_master WHERE name='stat' AND sql='CREATE VIRTUAL TABLE stat USING dbstat' ORDER BY rowid
;SELECT * FROM (SELECT 'sqlite_schema' AS name,1 AS rootpage,'table' AS type UNION ALL SELECT name,rootpage,type FROM "main".sqlite_schema WHERE rootpage!=0)WHERE name='t1'
;SELECT*FROM"temp".sqlite_master WHERE name='stat' AND sql='CREATE VIRTUAL TABLE stat USING dbstat' ORDER BY rowid
;SELECT*FROM"temp".sqlite_master WHERE name='stat' AND sql='CREATE VIRTUAL TABLE stat USING dbstat' ORDER BY rowid
;SELECT * FROM (SELECT 'sqlite_schema' AS name,1 AS rootpage,'table' AS type UNION ALL SELECT name,rootpage,type FROM "main".sqlite_schema WHERE rootpage!=0)WHERE name='t1'
;VACUUM 
;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE t1(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t2(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'t1' SELECT*FROM"main".'t1'
;INSERT INTO vacuum_db.'t2' SELECT*FROM"main".'t2'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;CREATE VIRTUAL TABLE temp.stat USING dbstat 
;SELECT*FROM"temp".sqlite_master WHERE name='stat' AND sql='CREATE VIRTUAL TABLE stat USING dbstat' ORDER BY rowid
;SELECT*FROM"temp".sqlite_master WHERE name='stat' AND sql='CREATE VIRTUAL TABLE stat USING dbstat' ORDER BY rowid
;SELECT pageno FROM stat WHERE name = 't1' ORDER BY pageno
;SELECT * FROM (SELECT 'sqlite_schema' AS name,1 AS rootpage,'table' AS type UNION ALL SELECT name,rootpage,type FROM "main".sqlite_schema WHERE rootpage!=0)WHERE name='t1'
;DROP TABLE temp.stat 
;SELECT*FROM"temp".sqlite_master WHERE name='stat' AND sql='CREATE VIRTUAL TABLE stat USING dbstat' ORDER BY rowid
;SELECT*FROM"temp".sqlite_master WHERE name='stat' AND sql='CREATE VIRTUAL TABLE stat USING dbstat' ORDER BY rowid
;SELECT * FROM (SELECT 'sqlite_schema' AS name,1 AS rootpage,'table' AS type UNION ALL SELECT name,rootpage,type FROM "main".sqlite_schema WHERE rootpage!=0)WHERE name='t1'
;SELECT*FROM"temp".sqlite_master WHERE name='stat' AND sql='CREATE VIRTUAL TABLE stat USING dbstat' ORDER BY rowid
;SELECT*FROM"temp".sqlite_master WHERE name='stat' AND sql='CREATE VIRTUAL TABLE stat USING dbstat' ORDER BY rowid
;SELECT * FROM (SELECT 'sqlite_schema' AS name,1 AS rootpage,'table' AS type UNION ALL SELECT name,rootpage,type FROM "main".sqlite_schema WHERE rootpage!=0)WHERE name='t1'
;