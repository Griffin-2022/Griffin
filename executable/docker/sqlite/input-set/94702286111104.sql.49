SAVEPOINT _tcl_transaction
;SAVEPOINT _tcl_transaction
;PRAGMA page_size = 1024;
;
;PRAGMA auto_vacuum = NONE 
;CREATE TABLE t1(a PRIMARY KEY, b UNIQUE);
;INSERT INTO t1 VALUES(1, randomblob(400));
;INSERT INTO t1 SELECT a+1,  randomblob(400) FROM t1;
;INSERT INTO t1 SELECT a+2,  randomblob(400) FROM t1;
;INSERT INTO t1 SELECT a+4,  randomblob(400) FROM t1;
;INSERT INTO t1 SELECT a+8,  randomblob(400) FROM t1;
;INSERT INTO t1 SELECT a+16, randomblob(400) FROM t1;
;INSERT INTO t1 SELECT a+32, randomblob(400) FROM t1;
;INSERT INTO t1 SELECT a+64, randomblob(400) FROM t1;
;CREATE TABLE t2(a PRIMARY KEY, b UNIQUE);
;INSERT INTO t2 SELECT * FROM t1;
;
;COMMIT
;COMMIT
;ATTACH 'test.db2' AS aux;
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;PRAGMA aux.page_size = 1024;
;CREATE TABLE aux.t3 AS SELECT * FROM t1;
;SELECT*FROM"aux".sqlite_master WHERE tbl_name='t3' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"aux".sqlite_master WHERE tbl_name='t3' AND type!='trigger' ORDER BY rowid
;DELETE FROM t3;
;
;VACUUM 
;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE t1(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t2(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'t1' SELECT*FROM"main".'t1'
;INSERT INTO vacuum_db.'t2' SELECT*FROM"main".'t2'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;VACUUM aux;
;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "aux".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE t3(a,b)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t3' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t3' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "aux".sqlite_schema WHERE type='index'
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"aux".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'t3' SELECT*FROM"aux".'t3'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "aux".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;CREATE TABLE t4(x);
;INSERT INTO t4(x) VALUES('x');
;INSERT INTO t4(x) VALUES('y');
;INSERT INTO t4(x) VALUES('z');
;DELETE FROM t4 WHERE x = 'y';
;SELECT rowid, x FROM t4;
;
;VACUUM;
;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE t1(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t2(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t4(x)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t4' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t4' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'t1' SELECT*FROM"main".'t1'
;INSERT INTO vacuum_db.'t2' SELECT*FROM"main".'t2'
;INSERT INTO vacuum_db.'t4' SELECT*FROM"main".'t4'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;
;CREATE TABLE t5(x, y INTEGER PRIMARY KEY);
;INSERT INTO t5(x) VALUES('x');
;INSERT INTO t5(x) VALUES('y');
;INSERT INTO t5(x) VALUES('z');
;DELETE FROM t5 WHERE x = 'y';
;SELECT rowid, x FROM t5;
;
;VACUUM;
;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE t1(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t2(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t4(x)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t4' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t4' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t5(x, y INTEGER PRIMARY KEY)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t5' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t5' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'t1' SELECT*FROM"main".'t1'
;INSERT INTO vacuum_db.'t2' SELECT*FROM"main".'t2'
;INSERT INTO vacuum_db.'t4' SELECT*FROM"main".'t4'
;INSERT INTO vacuum_db.'t5' SELECT*FROM"main".'t5'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;
;DROP TABLE t5;
;CREATE TABLE t5(x);
;INSERT INTO t5(x) VALUES('x');
;INSERT INTO t5(x) VALUES('y');
;INSERT INTO t5(x) VALUES('z');
;DELETE FROM t5 WHERE x = 'y';
;SELECT rowid, x FROM t5;
;
;VACUUM INTO 'test2.db';
;ATTACH 'test2.db' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE t1(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t2(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t4(x)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t4' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t4' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t5(x)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t5' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t5' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'t1' SELECT*FROM"main".'t1'
;INSERT INTO vacuum_db.'t2' SELECT*FROM"main".'t2'
;INSERT INTO vacuum_db.'t4' SELECT*FROM"main".'t4'
;INSERT INTO vacuum_db.'t5' SELECT*FROM"main".'t5'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;ATTACH 'test2.db' AS aux1;
;SELECT*FROM"aux1".sqlite_master ORDER BY rowid
;SELECT*FROM"aux1".sqlite_master ORDER BY rowid
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;SELECT rowid, x FROM aux1.t5;
;DETACH aux1;
;
;DROP TABLE t5;
;CREATE TABLE t5(x,y,z);
;INSERT INTO t5(x) VALUES('x');
;INSERT INTO t5(x) VALUES('y');
;INSERT INTO t5(x) VALUES('z');
;UPDATE t5 SET y=x, z=random();
;DELETE FROM t5 WHERE x = 'y';
;CREATE INDEX t5x ON t5(x);
;CREATE UNIQUE INDEX t5y ON t5(y);
;CREATE INDEX t5zxy ON t5(z,x,y);
;SELECT rowid, x FROM t5;
;
;VACUUM;
;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE t1(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t2(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t4(x)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t4' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t4' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t5(x,y,z)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t5' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t5' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;CREATE INDEX t5x ON t5(x)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5x' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5x' AND type='index' ORDER BY rowid
;CREATE UNIQUE INDEX t5y ON t5(y)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5y' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5y' AND type='index' ORDER BY rowid
;CREATE INDEX t5zxy ON t5(z,x,y)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5zxy' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5zxy' AND type='index' ORDER BY rowid
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'t1' SELECT*FROM"main".'t1'
;INSERT INTO vacuum_db.'t2' SELECT*FROM"main".'t2'
;INSERT INTO vacuum_db.'t4' SELECT*FROM"main".'t4'
;INSERT INTO vacuum_db.'t5' SELECT*FROM"main".'t5'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;
;BEGIN 
;VACUUM 

;COMMIT 
;VACUUM 
;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE t1(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t2(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t4(x)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t4' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t4' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t5(x,y,z)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t5' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t5' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;CREATE INDEX t5x ON t5(x)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5x' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5x' AND type='index' ORDER BY rowid
;CREATE UNIQUE INDEX t5y ON t5(y)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5y' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5y' AND type='index' ORDER BY rowid
;CREATE INDEX t5zxy ON t5(z,x,y)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5zxy' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5zxy' AND type='index' ORDER BY rowid
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'t1' SELECT*FROM"main".'t1'
;INSERT INTO vacuum_db.'t2' SELECT*FROM"main".'t2'
;INSERT INTO vacuum_db.'t4' SELECT*FROM"main".'t4'
;INSERT INTO vacuum_db.'t5' SELECT*FROM"main".'t5'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;SAVEPOINT x 
;VACUUM 

;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;SELECT*FROM"aux".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE t1(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t1' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t2(a PRIMARY KEY, b UNIQUE)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t2' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t4(x)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t4' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t4' AND type!='trigger' ORDER BY rowid
;CREATE TABLE t5(x,y,z)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t5' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='t5' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;CREATE INDEX t5x ON t5(x)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5x' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5x' AND type='index' ORDER BY rowid
;CREATE UNIQUE INDEX t5y ON t5(y)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5y' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5y' AND type='index' ORDER BY rowid
;CREATE INDEX t5zxy ON t5(z,x,y)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5zxy' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='t5zxy' AND type='index' ORDER BY rowid
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'t1' SELECT*FROM"main".'t1'
;INSERT INTO vacuum_db.'t2' SELECT*FROM"main".'t2'
;INSERT INTO vacuum_db.'t4' SELECT*FROM"main".'t4'
;INSERT INTO vacuum_db.'t5' SELECT*FROM"main".'t5'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;