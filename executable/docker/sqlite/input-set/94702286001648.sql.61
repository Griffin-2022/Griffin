CREATE TABLE messages (ROWID INTEGER PRIMARY KEY AUTOINCREMENT, message_id, document_id BLOB, in_reply_to, remote_id INTEGER, sender INTEGER, subject_prefix, subject INTEGER, date_sent INTEGER, date_received INTEGER, date_created INTEGER, date_last_viewed INTEGER, mailbox INTEGER, remote_mailbox INTEGER, original_mailbox INTEGER, flags INTEGER, read, flagged, size INTEGER, color, encoding, type INTEGER, pad, conversation_id INTEGER DEFAULT -1, snippet TEXT DEFAULT NULL, fuzzy_ancestor INTEGER DEFAULT NULL, automated_conversation INTEGER DEFAULT 0, root_status INTEGER DEFAULT -1, conversation_position INTEGER DEFAULT -1);
;CREATE INDEX date_index ON messages(date_received);
;CREATE INDEX date_last_viewed_index ON messages(date_last_viewed);
;CREATE INDEX date_created_index ON messages(date_created);
;CREATE INDEX message_message_id_mailbox_index ON messages(message_id, mailbox);
;CREATE INDEX message_document_id_index ON messages(document_id);
;CREATE INDEX message_read_index ON messages(read);
;CREATE INDEX message_flagged_index ON messages(flagged);
;CREATE INDEX message_mailbox_index ON messages(mailbox, date_received);
;CREATE INDEX message_remote_mailbox_index ON messages(remote_mailbox, remote_id);
;CREATE INDEX message_type_index ON messages(type);
;CREATE INDEX message_conversation_id_conversation_position_index ON messages(conversation_id, conversation_position);
;CREATE INDEX message_fuzzy_ancestor_index ON messages(fuzzy_ancestor);
;CREATE INDEX message_subject_fuzzy_ancestor_index ON messages(subject, fuzzy_ancestor);
;CREATE INDEX message_sender_subject_automated_conversation_index ON messages(sender, subject, automated_conversation);
;CREATE INDEX message_sender_index ON messages(sender);
;CREATE INDEX message_root_status ON messages(root_status);
;CREATE TABLE subjects (ROWID INTEGER PRIMARY KEY, subject COLLATE RTRIM, normalized_subject COLLATE RTRIM);
;CREATE INDEX subject_subject_index ON subjects(subject);
;CREATE INDEX subject_normalized_subject_index ON subjects(normalized_subject);
;CREATE TABLE addresses (ROWID INTEGER PRIMARY KEY, address COLLATE NOCASE, comment, UNIQUE(address, comment));
;CREATE INDEX addresses_address_index ON addresses(address);
;CREATE TABLE mailboxes (ROWID INTEGER PRIMARY KEY, url UNIQUE, total_count INTEGER DEFAULT 0, unread_count INTEGER DEFAULT 0, unseen_count INTEGER DEFAULT 0, deleted_count INTEGER DEFAULT 0, unread_count_adjusted_for_duplicates INTEGER DEFAULT 0, change_identifier, source INTEGER, alleged_change_identifier);
;CREATE INDEX mailboxes_source_index ON mailboxes(source);
;CREATE TABLE labels (ROWID INTEGER PRIMARY KEY, message_id INTEGER NOT NULL, mailbox_id INTEGER NOT NULL, UNIQUE(message_id, mailbox_id));
;CREATE INDEX labels_message_id_mailbox_id_index ON labels(message_id, mailbox_id);
;CREATE INDEX labels_mailbox_id_index ON labels(mailbox_id);
;explain query plan
  SELECT messages.ROWID,
         messages.message_id,
         messages.remote_id,
         messages.date_received,
         messages.date_sent,
         messages.flags,
         messages.size,
         messages.color,
         messages.date_last_viewed,
         messages.subject_prefix,
         subjects.subject,
         sender.comment,
         sender.address,
         NULL,
         messages.mailbox,
         messages.original_mailbox,
         NULL,
         NULL,
         messages.type,
         messages.document_id,
         sender,
         NULL,
         messages.conversation_id,
         messages.conversation_position,
         agglabels.labels
   FROM mailboxes AS mailbox
        JOIN messages ON mailbox.ROWID = messages.mailbox
        LEFT OUTER JOIN subjects ON messages.subject = subjects.ROWID
        LEFT OUTER JOIN addresses AS sender ON messages.sender = sender.ROWID
        LEFT OUTER JOIN (
               SELECT message_id, group_concat(mailbox_id) as labels
               FROM labels GROUP BY message_id
             ) AS agglabels ON messages.ROWID = agglabels.message_id
  WHERE (mailbox.url = 'imap://email.app@imap.gmail.com/%5BGmail%5D/All%20Mail')
    AND (messages.ROWID IN (
            SELECT labels.message_id
              FROM labels JOIN mailboxes ON labels.mailbox_id = mailboxes.ROWID
             WHERE mailboxes.url = 'imap://email.app@imap.gmail.com/INBOX'))
    AND messages.mailbox in (6,12,18,24,30,36,42,1,7,13,19,25,31,37,43,2,8,
                             14,20,26,32,38,3,9,15,21,27,33,39,4,10,16,22,28,
                             34,40,5,11,17,23,35,41)
   ORDER BY date_received DESC;
;
;CREATE TABLE t1(x INTEGER PRIMARY KEY, y, z);
;CREATE TABLE t2(a, b);
;CREATE VIEW agg2 AS SELECT a, sum(b) AS m FROM t2 GROUP BY a;
;EXPLAIN QUERY PLAN
  SELECT t1.z, agg2.m
    FROM t1 JOIN agg2 ON t1.y=agg2.m
   WHERE t1.x IN (1,2,3);
;
;CREATE TABLE t920(x);
;INSERT INTO t920 VALUES(3),(4),(5);
;SELECT * FROM t920,(SELECT 0 FROM t920),(VALUES(9)) WHERE 5 IN (x);
;
;CREATE TABLE t11(w);
;CREATE TABLE t12(y);
;INSERT INTO t11 VALUES(NULL);
;INSERT INTO t12 VALUES('notnull');
;
;SELECT count(*) FROM t11 LEFT JOIN t12 WHERE t12.y IS t11.w;
;
;