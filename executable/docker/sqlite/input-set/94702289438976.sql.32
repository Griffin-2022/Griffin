CREATE TABLE Instances(
    	instanceId INTEGER PRIMARY KEY,
    	troveName STR,
    	versionId INT,
    	flavorId INT,
    	timeStamps STR,
    	isPresent INT,
    	pinned BOOLEAN
    );
;INSERT INTO "Instances"
       VALUES(1, 'libhello:runtime', 1, 1, 1126929880.094, 1, 1);
;INSERT INTO "Instances"
       VALUES(2, 'libhello:user', 1, 1, 1126929880.094, 1, 0);
;INSERT INTO "Instances"
       VALUES(3, 'libhello:script', 1, 1, 1126929880.094, 1, 0);
;INSERT INTO "Instances"
       VALUES(4, 'libhello', 1, 1, 1126929880.094, 1, 0);
;CREATE TABLE Versions(versionId INTEGER PRIMARY KEY,version STR UNIQUE);
;INSERT INTO "Versions" VALUES(0, NULL);
;INSERT INTO "Versions" VALUES(1, '/localhost@rpl:linux/0-1-1');
;CREATE TABLE Flavors(flavorId integer primary key, flavor str unique);
;INSERT INTO "Flavors" VALUES(0, NULL);
;INSERT INTO "Flavors" VALUES(1, '1#x86');
;CREATE TEMPORARY TABLE tlList (
       row INTEGER PRIMARY KEY,
       name STRING,
       version STRING,
       flavor STRING
    );
;SELECT*FROM"temp".sqlite_master WHERE tbl_name='tlList' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"temp".sqlite_master WHERE tbl_name='tlList' AND type!='trigger' ORDER BY rowid
;INSERT INTO tlList 
      values(NULL, 'libhello:script', '/localhost@rpl:linux/0-1-1', '1#x86');
;INSERT INTO tlList 
      values(NULL, 'libhello:user', '/localhost@rpl:linux/0-1-1', '1#x86');
;INSERT INTO tlList 
      values(NULL, 'libhello:runtime', '/localhost@rpl:linux/0-1-1', '1#x86');
;
;select row, pinned from tlList, Instances, Versions, Flavors
        where
            Instances.troveName = tlList.name
        and Versions.version = tlList.version
        and Instances.versionId = Versions.versionId
        and (    Flavors.flavor = tlList.flavor or Flavors.flavor is NULL
             and tlList.flavor = '')
        and Instances.flavorId = Flavors.flavorId
    order by row asc;
;
;CREATE INDEX InstancesNameIdx ON Instances(troveName);
;CREATE UNIQUE INDEX InstancesIdx 
      ON Instances(troveName, versionId, flavorId);
;ANALYZE;
;SELECT tbl,idx,stat FROM 'main'.sqlite_stat1
;SELECT tbl,idx,stat FROM 'main'.sqlite_stat1
;select row, pinned from tlList, Instances, Versions, Flavors
        where
            Instances.troveName = tlList.name
        and Versions.version = tlList.version
        and Instances.versionId = Versions.versionId
        and (    Flavors.flavor = tlList.flavor or Flavors.flavor is NULL
             and tlList.flavor = '')
        and Instances.flavorId = Flavors.flavorId
    order by row asc;
;
;