CREATE TABLE tx(a, b);
;CREATE INDEX i1 ON tx(b);
;WITH s(i) AS (
      SELECT 8000 UNION ALL SELECT i+1 FROM s WHERE i<10000
  )
  INSERT INTO tx SELECT i, randomblob(i) FROM s;
;SELECT sum(length(b)) FROM tx;
;
;PRAGMA page_size = 2048;
;PRAGMA auto_vacuum = 0;
;
;VACUUM
;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE tx(a, b)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='tx' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='tx' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;CREATE INDEX i1 ON tx(b)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='i1' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='i1' AND type='index' ORDER BY rowid
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'tx' SELECT*FROM"main".'tx'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;PRAGMA integrity_check
;PRAGMA page_size = 1024;
;PRAGMA auto_vacuum = 1;
;
;VACUUM
;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE tx(a, b)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='tx' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='tx' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;CREATE INDEX i1 ON tx(b)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='i1' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='i1' AND type='index' ORDER BY rowid
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'tx' SELECT*FROM"main".'tx'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;PRAGMA integrity_check
;PRAGMA page_size = 65536;
;PRAGMA auto_vacuum = 0;
;
;VACUUM
;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE tx(a, b)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='tx' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='tx' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;CREATE INDEX i1 ON tx(b)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='i1' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='i1' AND type='index' ORDER BY rowid
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'tx' SELECT*FROM"main".'tx'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;PRAGMA integrity_check
;PRAGMA page_size = 8192;
;PRAGMA auto_vacuum = 1;
;
;VACUUM
;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE tx(a, b)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='tx' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='tx' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;CREATE INDEX i1 ON tx(b)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='i1' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='i1' AND type='index' ORDER BY rowid
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'tx' SELECT*FROM"main".'tx'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;PRAGMA integrity_check
;PRAGMA page_size = 512;
;PRAGMA auto_vacuum = 0;
;
;VACUUM
;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE tx(a, b)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='tx' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='tx' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;CREATE INDEX i1 ON tx(b)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='i1' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='i1' AND type='index' ORDER BY rowid
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'tx' SELECT*FROM"main".'tx'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;PRAGMA integrity_check
;PRAGMA page_size = 4096;
;PRAGMA auto_vacuum = 1;
;
;VACUUM
;ATTACH '' AS vacuum_db
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master ORDER BY rowid
;BEGIN
;SELECT sql FROM "main".sqlite_schema WHERE type='table'AND name<>'sqlite_sequence' AND coalesce(rootpage,1)>0
;CREATE TABLE tx(a, b)
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='tx' AND type!='trigger' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE tbl_name='tx' AND type!='trigger' ORDER BY rowid
;SELECT sql FROM "main".sqlite_schema WHERE type='index'
;CREATE INDEX i1 ON tx(b)
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='i1' AND type='index' ORDER BY rowid
;SELECT*FROM"vacuum_db".sqlite_master WHERE name='i1' AND type='index' ORDER BY rowid
;SELECT'INSERT INTO vacuum_db.'||quote(name)||' SELECT*FROM"main".'||quote(name)FROM vacuum_db.sqlite_schema WHERE type='table'AND coalesce(rootpage,1)>0
;INSERT INTO vacuum_db.'tx' SELECT*FROM"main".'tx'
;INSERT INTO vacuum_db.sqlite_schema SELECT*FROM "main".sqlite_schema WHERE type IN('view','trigger') OR(type='table'AND rootpage=0)
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;SELECT*FROM"temp".sqlite_temp_master ORDER BY rowid
;PRAGMA integrity_check
;