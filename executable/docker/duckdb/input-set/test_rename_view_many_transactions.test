# name: test/sql/alter/rename_view/test_rename_view_many_transactions.test
# description: Test RENAME VIEW four view renames and four parallel transactions
# group: [rename_view]

;
CREATE TABLE tbl1(i INTEGER)

;
INSERT INTO tbl1 VALUES (999), (100)

;
CREATE VIEW vw1 AS SELECT * FROM tbl1

# rename chain
# con2 starts a transaction now
;
BEGIN TRANSACTION

# rename in con1, con2 should still see "vw1"
;
ALTER VIEW vw1 RENAME TO vw2

# con3 starts a transaction now
;
BEGIN TRANSACTION

# rename in con1, con3 should still see "vw2"
;
ALTER VIEW vw2 RENAME TO vw3

# con4 starts a transaction now
;
BEGIN TRANSACTION

# rename in con1, con4 should still see "vw3"
;
ALTER VIEW vw3 RENAME TO vw4

# con2 sees ONLY vw1
;
SELECT * FROM vw1
;
999
100

;
SELECT * FROM vw2

;
SELECT * FROM vw3

;
SELECT * FROM vw4

# con3 sees ONLY vw2
;
SELECT * FROM vw1

;
SELECT * FROM vw2
;
999
100

;
SELECT * FROM vw3

;
SELECT * FROM vw4

# con4 sees ONLY vw3
;
SELECT * FROM vw1

;
SELECT * FROM vw2

;
SELECT * FROM vw3
;
999
100

;
SELECT * FROM vw4

# con1 sees ONLY vw4
;
SELECT * FROM vw1

;
SELECT * FROM vw2

;
SELECT * FROM vw3

;
SELECT * FROM vw4
;
999
100
