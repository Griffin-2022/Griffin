# name: test/sql/pragma/test_pragma_output.test
# description: Test last_profiling_output, detailed_profiling_output and all_profiling_output pragma
# group: [pragma]

#mode skip

# unclear what goes wrong here otherwise
;
PRAGMA threads=1

;
PRAGMA enable_profiling

;
PRAGMA enable_profiling='json'

;
PRAGMA enable_profiling='query_tree'

;
PRAGMA enable_profiling='query_tree_optimizer'

;
PRAGMA enable_profiling='unknown'

;
PRAGMA profiling_output='__TEST_DIR__/test.json'

;
PRAGMA profiling_mode = 'standard'

;
PRAGMA profiling_mode = detailed

;
PRAGMA profiling_mode = 'unknown'

;
CREATE TABLE tbl AS SELECT (i % 2)::TINYINT i FROM range(1) tbl(i);

;
SELECT * FROM pragma_last_profiling_output()

;
SELECT * FROM pragma_detailed_profiling_output()

;
PRAGMA all_profiling_output

;
PRAGMA profiler_history_size = -1

;
PRAGMA profiler_history_size = 5

;
SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min(i + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl

;
PRAGMA all_profiling_output

;
SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min(i + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl

;
SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min(i + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl

;
PRAGMA all_profiling_output

;
PRAGMA all_profiling_output

;
SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min(i + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl

;
SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min(i + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl

;
SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min(i + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl

;
SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min(i + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl

;
SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min(i + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl

;
SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min((SELECT  min(i + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl) + i) FROM tbl

;
PRAGMA all_profiling_output
