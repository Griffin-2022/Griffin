# name: test/sql/projection/test_complex_expressions.test
# description: Complex Expressions
# group: [projection]

;
PRAGMA enable_verification

;
CREATE TABLE exprtest (a INTEGER, b INTEGER)

;
INSERT INTO exprtest VALUES (42, 10), (43, 100), (NULL, 1), (45, -1)

;
SELECT * FROM exprtest
;
42	10
43	100
NULL	1
45	-1

# BETWEEN
;
SELECT a FROM exprtest WHERE a BETWEEN 43 AND 44
;
43

;
SELECT a FROM exprtest WHERE a NOT BETWEEN 43 AND 44
;
42
45

;
SELECT a FROM exprtest WHERE a BETWEEN b AND 44
;
42

# CASE
;
SELECT CASE a WHEN 42 THEN 100 WHEN 43 THEN 200 ELSE 300 END FROM exprtest
;
100
200
300
300

;
SELECT CASE WHEN a = 42 THEN 100 WHEN a = 43 THEN 200 ELSE 300 END FROM exprtest
;
100
200
300
300

;
SELECT CASE WHEN a = 42 THEN 100 WHEN a = 43 THEN 200 END FROM exprtest
;
100
200
NULL
NULL

# ABS
;
SELECT ABS(1), ABS(-1), ABS(NULL)
;
1	1	NULL

;
SELECT ABS(b) FROM exprtest
;
10
100
1
1

# IN
;
CREATE TABLE intest (a INTEGER, b INTEGER, c INTEGER)

;
INSERT INTO intest VALUES (42, 42, 42), (43, 42, 42), (44, 41, 44);

;
SELECT * FROM intest WHERE a IN (42, 43)
;
42	42	42
43	42	42

;
SELECT a IN (42, 43) FROM intest
;
1
1
0

;
SELECT * FROM intest WHERE a IN (86, 103, 162)
;

;
SELECT * FROM intest WHERE a IN (NULL, NULL, NULL, NULL)
;

;
SELECT * FROM intest WHERE a IN (b)
;
42	42	42

;
SELECT * FROM intest WHERE a IN (b, c)
;
42	42	42
44	41	44

;
SELECT * FROM intest WHERE a IN (43, b) ORDER BY 1
;
42	42	42
43	42	42

;
SELECT * FROM intest WHERE a NOT IN (42, 43)
;
44	41	44

;
SELECT * FROM intest WHERE a NOT IN (86, 103, 162) ORDER BY 1
;
42	42	42
43	42	42
44	41	44

;
SELECT * FROM intest WHERE a NOT IN (NULL, NULL)
;

;
SELECT * FROM intest WHERE a NOT IN (b) ORDER BY 1
;
43	42	42
44	41	44

;
SELECT * FROM intest WHERE a NOT IN (b, c)
;
43	42	42

;
SELECT * FROM intest WHERE a NOT IN (43, b)
;
44	41	44

;
SELECT * FROM intest WHERE NULL IN ('a', 'b')
;

;
SELECT * FROM intest WHERE NULL NOT IN ('a', 'b')
;

;
CREATE TABLE strtest (a INTEGER, b VARCHAR)

;
INSERT INTO strtest VALUES (1, 'a'), (2, 'h'), (3, 'd')

;
INSERT INTO strtest VALUES (4, NULL)

;
SELECT a FROM strtest WHERE b = 'a'
;
1

;
SELECT a FROM strtest WHERE b <> 'a'
;
2
3

;
SELECT a FROM strtest WHERE b < 'h'
;
1
3

;
SELECT a FROM strtest WHERE b <= 'h'
;
1
2
3

;
SELECT a FROM strtest WHERE b > 'h'
;

;
SELECT a FROM strtest WHERE b >= 'h'
;
2

