# name: test/sql/copy/csv/auto/test_header_detection.test
# description: Test csv header detection
# group: [auto]

require vector_size 512

# CSV file with two lines, none header
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/no_header.csv');

;
SELECT column0, column1, column2 FROM test ORDER BY column0;
;
123.000000	TEST1	2000-12-12
345.000000	TEST1	2000-12-13

;
DROP TABLE test;

# CSV file with two lines, one header
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/single_header.csv');

;
SELECT number, text, date FROM test ORDER BY number;
;
345.000000	TEST2	2000-12-13

;
DROP TABLE test;

# CSV file with three lines, one header, one skip row
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/skip_row.csv');

;
SELECT number, text, date FROM test ORDER BY number;
;
345.000000	TEST3	2000-12-13

;
DROP TABLE test;

# CSV file with three lines, one header, two skip rows
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/multiple_skip_row.csv');

;
SELECT number, text, date FROM test ORDER BY number;
;
345.000000	TEST4	2000-12-13

;
DROP TABLE test;

# CSV file with two lines both only strings
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/varchar_multi_line.csv');

;
SELECT * FROM test ORDER BY column0;
;
Alice	StreetA	TEST5
Bob	StreetB	TEST5

;
DROP TABLE test;

# CSV file with one line, two columns, only strings
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/varchar_single_line.csv');

;
SELECT column0, column1 FROM test ORDER BY column0;
;
Alice	StreetA

;
DROP TABLE test;

# CSV file with one line, two columns - one numeric, one string
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/mixed_single_line.csv');

;
SELECT column0, column1 FROM test ORDER BY column0;
;
1	StreetA

;
DROP TABLE test;

# CSV file with one line, one string column
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/single_value.csv');

;
SELECT * FROM test;
;
Test

;
DROP TABLE test;

# CSV file with one line, one numeric column
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/single_numeric.csv');

;
SELECT * FROM test;
;
1

;
DROP TABLE test;

# CSV with UTF-8 BOM marker that could mess up the header line parsing
;
CREATE TABLE test AS SELECT * FROM read_csv_auto('test/sql/copy/csv/data/auto/utf8bom.csv');

;
SELECT * FROM test;
;
1	Mark
2	Hannes

;
SELECT id FROM test;
;
1
2

;
DROP TABLE test;
