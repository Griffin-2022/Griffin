# name: test/sql/constraints/primarykey/test_primary_key.test
# description: Single PRIMARY KEY constraint
# group: [primarykey]

;
CREATE TABLE integers(i INTEGER PRIMARY KEY, j INTEGER)

# insert two conflicting pairs at the same time
;
INSERT INTO integers VALUES (3, 4), (3, 5)

# insert unique values
;
INSERT INTO integers VALUES (3, 4), (2, 5)

;
SELECT * FROM integers
;
3	4
2	5

# insert a duplicate value as part of a chain of values
;
INSERT INTO integers VALUES (6, 6), (3, 4);

# now insert just the first value
;
INSERT INTO integers VALUES (6, 6);

;
SELECT * FROM integers
;
3	4
2	5
6	6

# insert NULL value in PRIMARY KEY is not allowed
;
INSERT INTO integers VALUES (NULL, 4);

# update NULL is also not allowed
;
UPDATE integers SET i=NULL;

# insert the same value from multiple connections
# NOTE: this tests current behavior
# this can potentially change in the future
;
BEGIN TRANSACTION

;
BEGIN TRANSACTION

# insert from first connection succeeds
;
INSERT INTO integers VALUES (7, 8);

# insert from second connection also succeeds
;
INSERT INTO integers VALUES (7, 33);

# now committing the first transaction works
;
COMMIT

# but the second transaction results in a conflict
;
COMMIT

