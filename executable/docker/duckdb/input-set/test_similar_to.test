# name: test/sql/function/string/test_similar_to.test
# description: Test SIMILAR TO statement
# group: [string]

;
SELECT 'aaa' SIMILAR TO 'bbb'
;
0

;
SELECT 'aaa' SIMILAR TO 'aaa'
;
1

;
SELECT 'aaa' SIMILAR TO '.*'
;
1

;
SELECT 'aaa' SIMILAR TO 'a.*'
;
1

;
SELECT 'aaa' SIMILAR TO '.*a'
;
1

;
SELECT 'aaa' SIMILAR TO '.*b'
;
0

;
SELECT 'aaa' SIMILAR TO 'b.*'
;
0

;
SELECT 'aaa' SIMILAR TO 'a[a-z]a'
;
1

;
SELECT 'aaa' SIMILAR TO 'a[a-z]{2}'
;
1

;
SELECT 'aaa' SIMILAR TO 'a[a-z].*'
;
1

;
SELECT 'aaa' SIMILAR TO '[a-z][a-z].*'
;
1

;
SELECT 'aaa' SIMILAR TO '[a-z]{3}'
;
1

;
SELECT 'aaa' NOT SIMILAR TO '[b-z]{3}'
;
1

;
SELECT 'aaa' ~ 'aaa'
;
1

;
SELECT 'aaa' !~ 'bbb'
;
1

# similar to must match entire expression
;
SELECT 'aaa' ~ '^a'
;
0

;
SELECT 'aaa' ~ '^a+'
;
1

;
SELECT 'aaa' ~ '(a|b)*'
;
1

;
SELECT 'abc' ~ '^(b|c)'
;
0

# Test SIMILAR TO statement with expressions
;
CREATE TABLE strings (s STRING, p STRING);

;
INSERT INTO strings VALUES('aaa', 'a[a-z]a'), ('abab', 'ab.*'), ('aaa', 'a[a-z]a'), ('aaa', '.*b.*');

;
SELECT s FROM strings WHERE s SIMILAR TO 'ab.*'
;
abab

;
SELECT s FROM strings WHERE 'aba' SIMILAR TO p
;
aaa
abab
aaa
aaa

;
SELECT s FROM strings WHERE s SIMILAR TO p
;
aaa
abab
aaa

;
SELECT s FROM strings WHERE s NOT SIMILAR TO p
;
aaa

# invalid SIMILAR TO expression
;
SELECT s FROM strings WHERE s SIMILAR TO 'ab.*%' {escape ''}

