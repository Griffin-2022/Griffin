# name: test/sql/constraints/unique/test_unique_temp.test
# description: UNIQUE constraint on temporary tables
# group: [unique]

;
CREATE TEMPORARY TABLE integers(i INTEGER, j INTEGER)

;
CREATE UNIQUE INDEX uidx ON integers (i)

# insert unique values
;
INSERT INTO integers VALUES (3, 4), (2, 5)

;
SELECT * FROM integers
;
3	4
2	5

# insert a duplicate value as part of a chain of values, this should fail
;
INSERT INTO integers VALUES (6, 6), (3, 4);

;
INSERT INTO integers VALUES (NULL, 6), (NULL, 7)

# but if we try to replace them like this it's going to fail
;
UPDATE integers SET i=77 WHERE i IS NULL

;
SELECT * FROM integers ORDER BY i, j
;
NULL	6
NULL	7
2	5
3	4

# we can replace them like this though
;
UPDATE integers SET i=77 WHERE i IS NULL AND j=6

;
SELECT * FROM integers ORDER BY i, j
;
NULL	7
2	5
3	4
77	6

;
INSERT INTO integers VALUES (NULL, 6), (NULL, 7)

;
INSERT INTO integers VALUES (NULL, 6), (NULL, 7)

;
INSERT INTO integers VALUES (NULL, 6), (NULL, 7)

;
INSERT INTO integers VALUES (NULL, 6), (NULL, 7)

;
INSERT INTO integers VALUES (NULL, 6), (NULL, 7)

;
INSERT INTO integers VALUES (NULL, 6), (NULL, 7)

;
INSERT INTO integers VALUES (NULL, 6), (NULL, 7)

;
INSERT INTO integers VALUES (NULL, 6), (NULL, 7)

;
INSERT INTO integers VALUES (NULL, 6), (NULL, 7)

;
INSERT INTO integers VALUES (NULL, 6), (NULL, 7)

;
INSERT INTO integers VALUES (NULL, 6), (3, 7)

;
DROP TABLE integers
