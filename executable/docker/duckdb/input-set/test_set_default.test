# name: test/sql/alter/default/test_set_default.test
# description: Test ALTER TABLE SET DEFAULT
# group: [default]

;
CREATE TABLE test(i INTEGER, j INTEGER)

;
INSERT INTO test VALUES (1, 1), (2, 2)

;
ALTER TABLE test ALTER j SET DEFAULT 3

;
INSERT INTO test (i) VALUES (3)

;
SELECT * FROM test
;
1
1
2
2
3
3

;
ALTER TABLE test ALTER COLUMN j DROP DEFAULT

;
INSERT INTO test (i) VALUES (4)

;
SELECT * FROM test
;
1
1
2
2
3
3
4
NULL

;
CREATE SEQUENCE seq

;
ALTER TABLE test ALTER j SET DEFAULT nextval('seq')

;
INSERT INTO test (i) VALUES (5), (6)

;
SELECT * FROM test
;
1
1
2
2
3
3
4
NULL
5
1
6
2

# set default on a table with constraints
;
CREATE TABLE constrainty(i INTEGER PRIMARY KEY, j INTEGER);

;
ALTER TABLE constrainty ALTER j SET DEFAULT 3

;
INSERT INTO constrainty (i) VALUES (2)

;
SELECT * FROM constrainty
;
2	3

# fail when column does not exist
;
ALTER TABLE test ALTER blabla SET DEFAULT 3

;
ALTER TABLE test ALTER blabla DROP DEFAULT

