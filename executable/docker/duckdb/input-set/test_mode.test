# name: test/sql/aggregate/aggregates/test_mode.test
# description: Test mode function
# group: [aggregates]

#Corner cases
;
select mode()

;
select mode(NULL)
;
NULL

;
select mode(1)
;
1

;
select mode(*)

;
create table aggr(k int, v decimal(10,2));

;
insert into aggr (k, v) values (1, 10), (1, 10), (1, 20), (1, 21);

;
select mode(v) from aggr;
;
10

;
SELECT mode(2) FROM range(100);
;
2

;
insert into aggr (k, v) values (2, 20),(2, 20), (2, 25), (2, 30);

;
SELECT CASE
       WHEN ( value = 10 or value = 20)
            THEN TRUE
            ELSE FALSE
       END
       FROM (select mode(v) as value from aggr) AS T
;
1

;
insert into aggr (k, v) values (3, null);

;
select k, mode(v)
    from aggr
    group by k
    order by k;
;
1	10.000000
2	20.000000
3	NULL

;
create table names (name string)

;
insert into names values ('pedro'), ('pedro'), ('pedro'),('hannes'),('hannes'),('mark'),(null);

;
select mode(name) from names;
;
pedro

require vector_size 512

;
select k, v, mode(v) over (partition by k)
    from aggr
    order by k, v;
;
1	10.00	10.000000
1	10.00	10.000000
1	20.00	10.000000
1	21.00	10.000000
2	20.00	20.000000
2	20.00	20.000000
2	25.00	20.000000
2	30.00	20.000000
3	NULL	NULL

# Empty Table
;
SELECT mode(i) FROM range(100) tbl(i) WHERE 1=0;
;
NULL

# Temporal types
;
create table dates (k int, v date)

;
insert into dates values
    (1, '2021-05-02'),
    (1, '2021-05-02'),
    (2, '2021-05-02'),
    (2, '2020-02-29'),
    (2, '2020-02-29'),
    (3, '2004-09-01'),
    (1, null);

;
select mode(v) from dates;
;
2021-05-02

;
select k, mode(v) from dates group by k;
;
1	2021-05-02
2	2020-02-29
3	2004-09-01

;
select k, v, mode(v) over (partition by k)
    from dates
    order by k, v;
;
1	NULL	2021-05-02
1	2021-05-02	2021-05-02
1	2021-05-02	2021-05-02
2	2020-02-29	2020-02-29
2	2020-02-29	2020-02-29
2	2021-05-02	2020-02-29
3	2004-09-01	2004-09-01

;
create table times (k int, v time)

;
insert into times values
    (1, '12:11:49.5'),
    (1, '12:11:49.5'),
    (2, '12:11:49.5'),
    (2, '06:30:00'),
    (2, '06:30:00'),
    (3, '21:15:22'),
    (1, null);

;
select mode(v) from times;
;
12:11:49.5

;
select k, mode(v) from times group by k;
;
1	12:11:49.5
2	06:30:00
3	21:15:22

;
select k, v, mode(v) over (partition by k)
    from times
    order by k, v;
;
1	NULL	12:11:49.5
1	12:11:49.5	12:11:49.5
1	12:11:49.5	12:11:49.5
2	06:30:00	06:30:00
2	06:30:00	06:30:00
2	12:11:49.5	06:30:00
3	21:15:22	21:15:22

;
create table timestamps (k int, v timestamp)

;
insert into timestamps values
    (1, '2021-05-02 12:11:49.5'),
    (1, '2021-05-02 12:11:49.5'),
    (2, '2021-05-02 12:11:49.5'),
    (2,'2020-02-29 06:30:00'),
    (2,'2020-02-29 06:30:00'),
    (3,'2004-09-01 21:15:22'),
    (1, null);

;
select mode(v) from timestamps;
;
2021-05-02 12:11:49.5

;
select k, mode(v) from timestamps group by k;
;
1	2021-05-02 12:11:49.5
2	2020-02-29 06:30:00
3	2004-09-01 21:15:22

;
select k, v, mode(v) over (partition by k)
    from timestamps
    order by k, v;
;
1	NULL	2021-05-02 12:11:49.5
1	2021-05-02 12:11:49.5	2021-05-02 12:11:49.5
1	2021-05-02 12:11:49.5	2021-05-02 12:11:49.5
2	2020-02-29 06:30:00	2020-02-29 06:30:00
2	2020-02-29 06:30:00	2020-02-29 06:30:00
2	2021-05-02 12:11:49.5	2020-02-29 06:30:00
3	2004-09-01 21:15:22	2004-09-01 21:15:22

;
create table intervals (k int, v interval)

;
insert into intervals values
    (1, INTERVAL '5 months 2 days 12 hours 11 minutes 49 seconds'),
    (1, INTERVAL '5 months 2 days 12 hours 11 minutes 49 seconds'),
    (2, INTERVAL '5 months 2 days 12 hours 11 minutes 49 seconds'),
    (2, INTERVAL '2 months 29 days 6 hours 30 minutes'),
    (2, INTERVAL '2 months 29 days 6 hours 30 minutes'),
    (3, INTERVAL '9 months 1 day 21 hours 15 minutes 22 seconds'),
    (1, null);

;
select mode(v) from intervals;
;
5 months 2 days 12:11:49

;
select k, mode(v) from intervals group by k;
;
1	5 months 2 days 12:11:49
2	2 months 29 days 06:30:00
3	9 months 1 day 21:15:22

;
select k, v, mode(v) over (partition by k)
    from intervals
    order by k, v;
;
1	NULL	5 months 2 days 12:11:49
1	5 months 2 days 12:11:49	5 months 2 days 12:11:49
1	5 months 2 days 12:11:49	5 months 2 days 12:11:49
2	2 months 29 days 06:30:00	2 months 29 days 06:30:00
2	2 months 29 days 06:30:00	2 months 29 days 06:30:00
2	5 months 2 days 12:11:49	2 months 29 days 06:30:00
3	9 months 1 day 21:15:22	9 months 1 day 21:15:22

# Huge integers

;
create table hugeints (k int, v hugeint)

;
insert into hugeints values (1, 5), (1, 5), (2, 5), (2, 2), (2, 2), (3, 1), (1, null);

;
select mode(v) from hugeints;
;
5

;
select k, mode(v) from hugeints group by k;
;
1	5
2	2
3	1

;
select k, v, mode(v) over (partition by k)
    from hugeints
    order by k, v;
;
1	NULL	5
1	5	5
1	5	5
2	2	2
2	2	2
2	5	2
3	1	1
