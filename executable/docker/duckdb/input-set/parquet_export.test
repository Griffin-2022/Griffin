# name: test/sql/export/parquet_export.test
# description: Test EXPORT/IMPORT database with parquet
# group: [export]

require parquet

require vector_size 64

;
PRAGMA enable_verification

;
BEGIN TRANSACTION

;
CREATE TABLE integers(i INTEGER NOT NULL, j INTEGER)

;
INSERT INTO integers SELECT i, i+1 FROM range(0, 1000) tbl(i)

;
SELECT SUM(i), SUM(j) FROM integers

;
EXPORT DATABASE '__TEST_DIR__/export_test' (FORMAT PARQUET)

;
ROLLBACK

;
IMPORT DATABASE '__TEST_DIR__/export_test'

# verify the data is still there
;
SELECT SUM(i), SUM(j) FROM integers

# verify that the not null constraint is still there
;
INSERT INTO integers VALUES (NULL, NULL)

;
DROP TABLE integers

# now do it with a codec specified
;
BEGIN TRANSACTION

;
CREATE TABLE integers(i INTEGER NOT NULL, j INTEGER)

;
INSERT INTO integers SELECT i, i+1 FROM range(0, 1000) tbl(i)

;
SELECT SUM(i), SUM(j) FROM integers

;
EXPORT DATABASE '__TEST_DIR__/export_test' (FORMAT PARQUET, CODEC 'SNAPPY')

;
ROLLBACK

;
IMPORT DATABASE '__TEST_DIR__/export_test'

# verify the data is still there
;
SELECT SUM(i), SUM(j) FROM integers

# verify that the not null constraint is still there
;
INSERT INTO integers VALUES (NULL, NULL)
