# name: test/sql/types/list/list_of_struct.test
# description: Test list of structs
# group: [list]

;
PRAGMA enable_verification

;
CREATE TABLE a AS SELECT [{'a': 3, 'b': 'hello'}, NULL, {'a': NULL, 'b': 'thisisalongstring'}] l;

;
SELECT * FROM a;
;
[{'a': 3, 'b': hello}, NULL, {'a': NULL, 'b': thisisalongstring}]

;
INSERT INTO a VALUES (NULL)

;
SELECT * FROM a;
;
[{'a': 3, 'b': hello}, NULL, {'a': NULL, 'b': thisisalongstring}]
NULL

;
INSERT INTO a VALUES ([{'a': 17, 'b': 'world'}])

;
SELECT * FROM a;
;
[{'a': 3, 'b': hello}, NULL, {'a': NULL, 'b': thisisalongstring}]
NULL
[{'a': 17, 'b': world}]

;
SELECT UNNEST(l) FROM a
;
{'a': 3, 'b': hello}
NULL
{'a': NULL, 'b': thisisalongstring}
{'a': 17, 'b': world}

# list of nested structs with lists
;
CREATE TABLE b AS SELECT [
	{'a': {'a1': [1, 2, 3], 'a2': 17}, 'b': 'hello'},
	NULL,
	{'a': {'a1': [NULL, 4, 5], 'a2': NULL}, 'b': 'thisisalongstring'},
	{'a': {'a1': NULL, 'a2': 22}, 'b': NULL},
	{'a': NULL, 'b': 'aaaaaaaaaaaaaaaaaaaaaaaa'}] l;

;
SELECT * FROM b;
;
[{'a': {'a1': [1, 2, 3], 'a2': 17}, 'b': hello}, NULL, {'a': {'a1': [NULL, 4, 5], 'a2': NULL}, 'b': thisisalongstring}, {'a': {'a1': NULL, 'a2': 22}, 'b': NULL}, {'a': NULL, 'b': aaaaaaaaaaaaaaaaaaaaaaaa}]

;
SELECT UNNEST(l) FROM b;
;
{'a': {'a1': [1, 2, 3], 'a2': 17}, 'b': hello}
NULL
{'a': {'a1': [NULL, 4, 5], 'a2': NULL}, 'b': thisisalongstring}
{'a': {'a1': NULL, 'a2': 22}, 'b': NULL}
{'a': NULL, 'b': aaaaaaaaaaaaaaaaaaaaaaaa}

;
SELECT UNNEST(l)['a']['a1'] FROM b;
;
[1, 2, 3]
NULL
[NULL, 4, 5]
NULL
NULL

;
SELECT UNNEST(l)['a']['a2'] FROM b;
;
17
NULL
NULL
22
NULL

;
INSERT INTO b VALUES (NULL), ([
	{'a': {'a1': [6, 7, 8, 9], 'a2': 17}, 'b': 'world1'},
	NULL,
	{'a': {'a1': [10, 11, 12], 'a2': 22}, 'b': 'world2'}
])

;
SELECT * FROM b;
;
[{'a': {'a1': [1, 2, 3], 'a2': 17}, 'b': hello}, NULL, {'a': {'a1': [NULL, 4, 5], 'a2': NULL}, 'b': thisisalongstring}, {'a': {'a1': NULL, 'a2': 22}, 'b': NULL}, {'a': NULL, 'b': aaaaaaaaaaaaaaaaaaaaaaaa}]
NULL
[{'a': {'a1': [6, 7, 8, 9], 'a2': 17}, 'b': world1}, NULL, {'a': {'a1': [10, 11, 12], 'a2': 22}, 'b': world2}]

;
SELECT UNNEST(l) FROM b;
;
{'a': {'a1': [1, 2, 3], 'a2': 17}, 'b': hello}
NULL
{'a': {'a1': [NULL, 4, 5], 'a2': NULL}, 'b': thisisalongstring}
{'a': {'a1': NULL, 'a2': 22}, 'b': NULL}
{'a': NULL, 'b': aaaaaaaaaaaaaaaaaaaaaaaa}
{'a': {'a1': [6, 7, 8, 9], 'a2': 17}, 'b': world1}
NULL
{'a': {'a1': [10, 11, 12], 'a2': 22}, 'b': world2}

;
SELECT UNNEST(l)['a'] FROM b;
;
{'a1': [1, 2, 3], 'a2': 17}
NULL
{'a1': [NULL, 4, 5], 'a2': NULL}
{'a1': NULL, 'a2': 22}
NULL
{'a1': [6, 7, 8, 9], 'a2': 17}
NULL
{'a1': [10, 11, 12], 'a2': 22}

;
SELECT UNNEST(l)['a']['a1'] FROM b;
;
[1, 2, 3]
NULL
[NULL, 4, 5]
NULL
NULL
[6, 7, 8, 9]
NULL
[10, 11, 12]
