# name: test/sql/storage/wal/wal_store_deletes.test
# description: Test deletes with storage with WAL
# group: [wal]

# load the DB from disk
load __TEST_DIR__/test_store_deletes.db

;
PRAGMA disable_checkpoint_on_shutdown

;
PRAGMA wal_autocheckpoint='1TB';

;
BEGIN TRANSACTION;

;
CREATE TABLE test (a INTEGER, b INTEGER);

;
INSERT INTO test VALUES (11, 22), (12, 21), (13, 22), (12, 21)

;
DELETE FROM test WHERE a=12

;
SELECT a, b FROM test ORDER BY a
;
11	22
13	22

;
COMMIT

restart

;
PRAGMA disable_checkpoint_on_shutdown

;
PRAGMA wal_autocheckpoint='1TB';

;
SELECT a, b FROM test ORDER BY a
;
11	22
13	22

;
DELETE FROM test WHERE a=11

;
SELECT a, b FROM test ORDER BY a
;
13	22

;
INSERT INTO test VALUES (11, 24), (12, 25)

;
SELECT a, b FROM test ORDER BY a
;
11	24
12	25
13	22

;
DELETE FROM test WHERE a=12

;
SELECT a, b FROM test ORDER BY a
;
11	24
13	22

restart

;
PRAGMA disable_checkpoint_on_shutdown

;
SELECT a, b FROM test ORDER BY a
;
11	24
13	22
