# name: test/sql/copy/csv/auto/test_sample_size.test
# description: Test optional parameters for read csv
# group: [auto]

require vector_size 512

# CSV file with very sparse column
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/issue_811.csv', SAMPLE_SIZE=1024);

;
SELECT typeof(TestInteger), typeof(TestDouble), typeof(TestDate), typeof(TestText) FROM test LIMIT 1
;
INTEGER	VARCHAR	DATE	VARCHAR

;
DROP TABLE test

# CSV file with very sparse column
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/issue_811.csv', SAMPLE_SIZE=-1);

;
SELECT typeof(TestInteger), typeof(TestDouble), typeof(TestDate), typeof(TestText) FROM test LIMIT 1
;
INTEGER	DOUBLE	DATE	VARCHAR

;
DROP TABLE test

# CSV file with very sparse column and sample size 500
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/issue_811.csv', SAMPLE_CHUNK_SIZE = 500);

;
SELECT TestInteger, TestDouble, TestDate, TestText FROM test WHERE TestDouble is not NULL ;
;
5	1.1	2015-05-01	fdf

;
SELECT typeof(TestInteger), typeof(TestDouble), typeof(TestDate), typeof(TestText) FROM test LIMIT 1;
;
INTEGER	DOUBLE	DATE	VARCHAR

;
drop table test;

# CSV file with very sparse column and number of samples 50
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/issue_811.csv', SAMPLE_CHUNKS = 50);

;
SELECT TestInteger, TestDouble, TestDate, TestText FROM test WHERE TestDouble is not NULL ;
;
5	1.1	2015-05-01	fdf

;
SELECT typeof(TestInteger), typeof(TestDouble), typeof(TestDate), typeof(TestText) FROM test LIMIT 1;
;
INTEGER	DOUBLE	DATE	VARCHAR

;
drop table test;

# CSV file with very sparse column with sample size 200 and number of samples 20
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/issue_811.csv', SAMPLE_CHUNK_SIZE = 200, SAMPLE_CHUNKS = 20);

;
SELECT TestInteger, TestDouble, TestDate, TestText FROM test WHERE TestDouble is not NULL ;
;
5	1.1	2015-05-01	fdf

;
SELECT typeof(TestInteger), typeof(TestDouble), typeof(TestDate), typeof(TestText) FROM test LIMIT 1;
;
INTEGER	DOUBLE	DATE	VARCHAR

;
drop table test;

# CSV file with very sparse column using copy into
;
CREATE TABLE test (TestInteger integer, TestDouble double, TestDate varchar, TestText varchar);

# CSV file with very sparse column, automatically aligns column types, small sample size
;
COPY test FROM 'test/sql/copy/csv/data/auto/issue_811.csv' (SAMPLE_CHUNK_SIZE 4, AUTO_DETECT TRUE);

;
drop table test;

# CSV file with very sparse column using copy into
;
CREATE TABLE test (TestInteger integer, TestDouble double, TestDate varchar, TestText varchar);

# CSV file with very sparse column, automatically aligns column types, small sample size
;
COPY test FROM 'test/sql/copy/csv/data/auto/issue_811.csv' (SAMPLE_SIZE -1, AUTO_DETECT TRUE);

;
drop table test;