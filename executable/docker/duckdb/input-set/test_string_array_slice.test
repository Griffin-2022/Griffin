# name: test/sql/function/string/test_string_array_slice.test
# description: String slicing test
# group: [string]

;
PRAGMA enable_verification

;
SELECT 'hello'[0:2]
;
he

;
SELECT ('hello')[0:2]
;
he

;
CREATE TABLE strings(s VARCHAR, off INTEGER, length INTEGER);

;
INSERT INTO strings VALUES ('hello', 0, 2), ('world', 1, 3), ('b', 0, 1), (NULL, 1, 2)

# test zero length
;
SELECT array_slice('ðŸ¦†ab', 0, 0), array_slice('abc', 0, 0)
;
(empty)	(empty)

# constant offset/length
# normal slice
;
SELECT array_slice(s, 0, 2) FROM strings
;
he
wo
b
NULL

# list_slice alias
;
SELECT list_slice(s, 0, 2) FROM strings
;
he
wo
b
NULL

;
SELECT array_slice(s, 1, 3) FROM strings
;
hel
wor
b
NULL

# index out of range
;
SELECT array_slice(s, 2, 3) FROM strings
;
el
or
(empty)
NULL

# variable length offset/length
;
SELECT array_slice(s, off, length+off) FROM strings
;
he
worl
b
NULL

;
SELECT array_slice(s, off, 2+off) FROM strings
;
he
wor
b
NULL

;
SELECT array_slice(s, 0, length) FROM strings
;
he
wor
b
NULL

;
SELECT array_slice('hello', off, length+off) FROM strings
;
he
hell
h
hel

# test substrings with constant nulls in different places
;
SELECT array_slice(NULL::varchar, off, length+off) FROM strings
;
NULL
NULL
NULL
NULL

;
SELECT array_slice('hello', NULL, length+NULL) FROM strings
;
hello
hello
hello
hello

;
SELECT array_slice('hello', off+1, NULL+off) FROM strings
;
hello
ello
hello
ello

;
SELECT array_slice(NULL::varchar, NULL, length+NULL) FROM strings
;
NULL
NULL
NULL
NULL

;
SELECT array_slice('hello', NULL, NULL+NULL) FROM strings
;
hello
hello
hello
hello

;
SELECT array_slice(NULL::varchar, off, NULL+off) FROM strings
;
NULL
NULL
NULL
NULL

;
SELECT array_slice(NULL::varchar, NULL, NULL+NULL) FROM strings
;
NULL
NULL
NULL
NULL

# fixed slice
;
SELECT array_slice(s, -2, NULL) FROM strings
;
lo
ld
NULL
NULL

# length 1
;
SELECT array_slice(s, 0, 1) FROM strings
;
h
w
b
NULL

# negative offset and negative length
;
SELECT array_slice(s, -4, -2) FROM strings
;
el
or
NULL
NULL

# length 0
;
SELECT array_slice(s, 1, 0) FROM strings
;
(empty)
(empty)
(empty)
NULL

# no end
;
SELECT array_slice(s, 2, NULL) FROM strings
;
ello
orld
(empty)
NULL

# very large offset and length
;
SELECT array_slice(s, (2147483647-1), 1) FROM strings
;
(empty)
(empty)
(empty)
NULL

;
SELECT array_slice(s, (2147483647-1), -1) FROM strings
;
(empty)
(empty)
(empty)
NULL

;
SELECT array_slice(s, (-2147483646-1), -1) FROM strings
;
NULL
NULL
NULL
NULL

;
SELECT array_slice(s, (-2147483646-1), -2147483647) FROM strings
;
NULL
NULL
NULL
NULL
