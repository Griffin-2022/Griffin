# name: test/sql/parallelism/intraquery/test_simple_parallelism.test
# description: Test simple parallelism
# group: [intraquery]

;
PRAGMA enable_verification

;
PRAGMA threads=4

;
PRAGMA verify_parallelism


;
PRAGMA enable_profiling

;
PRAGMA profiling_output='__TEST_DIR__/test.json'

;
PRAGMA profiling_mode = detailed

;
CREATE TABLE integers(i INTEGER)

;
INSERT INTO integers VALUES (1), (2), (3), (NULL)

# perform a query with many pipelines
;
SELECT SUM(i) FROM integers UNION ALL SELECT AVG(i) FROM integers UNION ALL SELECT MIN(i) FROM integers UNION ALL SELECT MAX(i) FROM integers;
;
6.000000
2.000000
1.000000
3.000000

;
CREATE VIEW v1(i) AS SELECT SUM(i) FROM integers UNION ALL SELECT AVG(i) FROM integers UNION ALL SELECT MIN(i) FROM integers UNION ALL SELECT MAX(i) FROM integers;

# errors in separate pipelines
;
SELECT SUM(i) FROM integers UNION ALL SELECT AVG(i) FROM integers UNION ALL SELECT MIN(i::DATE) FROM integers UNION ALL SELECT MAX(i::DATE) FROM integers;

# errors are properly cleared
;
SELECT * FROM v1 t1 JOIN v1 t2 USING (i);
;
6.000000
2.000000
1.000000
3.000000

