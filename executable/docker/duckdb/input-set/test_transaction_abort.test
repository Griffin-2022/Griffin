# name: test/sql/transactions/test_transaction_abort.test
# description: Test transaction aborts after failures
# group: [transactions]

;
PRAGMA enable_verification

# set up a table
;
CREATE TABLE integers(i INTEGER PRIMARY KEY)

;
INSERT INTO integers VALUES (1), (2)

# start a transaction
;
BEGIN TRANSACTION

# parser errors do not invalidate the current transaction
;
SELEC 42

;
SELECT 42
;
42

# neither do binder errors
;
SELECT * FROM nonexistanttable

;
SELECT 42
;
42

# however primary key conflicts do invalidate it
;
UPDATE integers SET i=2

;
SELECT 42

# now we need to rollback
;
ROLLBACK

;
SELECT * FROM integers ORDER BY 1
;
1
2

