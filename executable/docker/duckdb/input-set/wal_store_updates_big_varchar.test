# name: test/sql/storage/wal/wal_store_updates_big_varchar.test
# description: Test updates with storage and null values
# group: [wal]

# load the DB from disk
load __TEST_DIR__/test_store_updates.db

;
PRAGMA disable_checkpoint_on_shutdown

;
PRAGMA wal_autocheckpoint='1TB';

;
CREATE TABLE test AS SELECT (-i)::VARCHAR a, (-i)::VARCHAR b FROM range(100000) tbl(i)

;
INSERT INTO test VALUES ('11', '22'), (NULL, '22'), ('12', '21')

;
UPDATE test SET b=(b::INT+1)::VARCHAR WHERE a='11'
;
1

;
SELECT a, b FROM test WHERE a::INTEGER>0 OR a IS NULL ORDER BY a
;
NULL	22
11	23
12	21

;
UPDATE test SET b=(b::INT+1)::VARCHAR WHERE a='11'
;
1

;
SELECT a, b FROM test WHERE a::INTEGER>0 OR a IS NULL ORDER BY a
;
NULL	22
11	24
12	21

;
UPDATE test SET b=NULL WHERE a='11'

;
SELECT a, b FROM test WHERE a::INTEGER>0 OR a IS NULL ORDER BY a
;
NULL	22
11	NULL
12	21

restart

;
SELECT a, b FROM test WHERE a::INTEGER>0 OR a IS NULL ORDER BY a
;
NULL	22
11	NULL
12	21

restart

;
SELECT a, b FROM test WHERE a::INTEGER>0 OR a IS NULL ORDER BY a
;
NULL	22
11	NULL
12	21
