# name: test/sql/update/test_unaligned_update.test
# description: Unaligned updates
# group: [update]

;
PRAGMA enable_verification

;
CREATE TABLE t1 AS SELECT * FROM generate_series(0, 1999, 1) tbl(i)

;
CREATE TABLE t2 AS SELECT * FROM generate_series(0, 4999, 1) tbl(i)

;
SELECT SUM(i) FROM t1
;
1999000

;
SELECT SUM(i) FROM t2
;
12497500

;
SELECT COUNT(*) FROM t1, t2 WHERE t1.i<33
;
165000

;
SELECT COUNT(*) FROM t1, t2 WHERE t2.i<33
;
66000

# update with a cross-product
;
UPDATE t1 SET i=33 FROM t2 WHERE t1.i<33

;
UPDATE t2 SET i=33 FROM t1 WHERE t2.i<33

;
SELECT SUM(i) FROM t1
;
1999561

;
SELECT SUM(i) FROM t2
;
12498061

# update with a inequality join
;
UPDATE t1 SET i=34 FROM t2 WHERE t1.i=33 AND t1.i<>t2.i

;
UPDATE t2 SET i=34 FROM t1 WHERE t2.i=33 AND t1.i<>t2.i

;
SELECT SUM(i) FROM t1
;
1999595

;
SELECT SUM(i) FROM t2
;
12498095

# update with a range join
;
UPDATE t1 SET i=35 FROM t2 WHERE t1.i=34 AND t1.i<t2.i

;
UPDATE t2 SET i=35 FROM t1 WHERE t2.i=34 AND t2.i<t1.i

;
SELECT SUM(i) FROM t1
;
1999630

;
SELECT SUM(i) FROM t2
;
12498130
