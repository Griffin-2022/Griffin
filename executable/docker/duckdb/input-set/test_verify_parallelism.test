# name: test/sql/parallelism/intraquery/test_verify_parallelism.test
# description: Test force parallelism on small-ish tables (few thousand rows)
# group: [intraquery]

;
PRAGMA enable_verification

;
PRAGMA threads=4

;
PRAGMA verify_parallelism

;
PRAGMA enable_profiling

;
PRAGMA profiling_output='__TEST_DIR__/test.json'

;
PRAGMA profiling_mode = detailed

;
CREATE TABLE integers AS SELECT * FROM range(0, 5000) tbl(i)

# test simple aggregates
;
SELECT MIN(i), MAX(i) FROM integers
;
0	4999

;
SELECT MIN(i), MAX(i) FROM integers WHERE i>2000
;
2001	4999

# test grouped aggregates
;
CREATE TABLE integers2 AS SELECT i%4 i, i j FROM range(0, 5000) tbl(i)

;
SELECT i, SUM(j), MIN(j), MAX(j) FROM integers2 GROUP BY i ORDER BY i
;
0	3122500	0	4996
1	3123750	1	4997
2	3125000	2	4998
3	3126250	3	4999
