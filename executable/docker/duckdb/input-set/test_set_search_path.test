# name: test/sql/catalog/test_set_search_path.test
# description: SET schema and SET search_path
# group: [catalog]

# create a couple of schemas with a table each
;
CREATE TABLE main_table(i INTEGER);

;
CREATE SCHEMA test;

;
CREATE TABLE test.test_table(i INTEGER);

;
CREATE SCHEMA test2;

;
CREATE TABLE test2.bye(i INTEGER);
CREATE TABLE test2.test2_table(i INTEGER);

;
CREATE SCHEMA test3;

;
CREATE SCHEMA test4;

;
CREATE SCHEMA test5;

;
CREATE TABLE test5.test5_table(i INTEGER);

# Reading the config - It should be empty for now.
;
SELECT CURRENT_SETTING('search_path');

;
SELECT CURRENT_SETTING('schema');

# Setting the default value.
;
SET SEARCH_PATH = 'test';

;
SET SEARCH_PATH = 'test,test2';

;
SET SEARCH_PATH = '"test","test2"';

;
SET SEARCH_PATH = '"test","test2"';

;
SET SEARCH_PATH = 'does_not_exist';

# Setting the default value through 'schema'

;
SET SCHEMA = 'test';

;
SET SCHEMA = 'test,test2';

;
SET SCHEMA = 'does_not_exist';

# Reading out to see how aliasing works.

;
SET SEARCH_PATH = 'test,test2';

;
SET SEARCH_PATH = '"invalid quoted string list';

;
SELECT MAIN.CURRENT_SETTING('search_path');
;
test,test2

;
SELECT MAIN.CURRENT_SETTING('schema');
;
test,test2

;
SET SCHEMA = 'test';

;
SELECT MAIN.CURRENT_SETTING('search_path');
;
test

;
SELECT MAIN.CURRENT_SETTING('schema');
;
test

;
SELECT current_schema();
;
test

;
SELECT current_schemas(false);
;
[temp, test, main, pg_catalog]

# Case insensitivity

;
SET schema = 'test2';

;
SELECT CURRENT_SETTING('search_path');
;
test2

;
SET search_path = 'test3';

;
SELECT CURRENT_SETTING('search_path');
;
test3

# Looking up from multiple schemas

;
SET SEARCH_PATH = 'test,test2';

;
SELECT i FROM test_table;

;
SELECT i FROM test2_table;

;
SELECT i FROM main_table;

;
CREATE TABLE main.table_with_same_name(in_main INTEGER);

;
CREATE TABLE test.table_with_same_name(in_test INTEGER);

;
CREATE TABLE test2.table_with_same_name(in_test2 INTEGER);

;
SELECT in_main FROM table_with_same_name;

;
SELECT in_test2 FROM table_with_same_name;

;
SELECT in_test FROM table_with_same_name;


# Or even more schemas

;
SET SEARCH_PATH = 'test,test2,test3,test4,test5';

;
---
SELECT i FROM test5_table;

;
SELECT i FROM test_table;

;
SELECT i FROM test2_table;

;
SELECT i FROM main_table;

# Duplicate entry in the path (is allowed)

;
SET SEARCH_PATH = 'test,test,test2';

;
SELECT i FROM test_table;

;
SELECT i FROM test2_table;

;
SELECT i FROM main_table;

# Multiple connections

;
SET schema = 'test';

;
SET schema = 'test2';

;
SELECT i FROM test_table;

;
SELECT i FROM test_table;

;
SELECT i FROM test2_table;

;
SELECT i FROM test2_table;

