# name: test/sql/types/list/list_distinct.test
# description: Test LIST distinctions
# group: [list]

;
PRAGMA enable_verification

# Constant single integer column distinctions
;
SELECT [1] IS NOT DISTINCT FROM [2]
;
false

;
SELECT [1] IS NOT DISTINCT FROM [1]
;
true

;
SELECT NULL IS NOT DISTINCT FROM [1]
;
false

;
SELECT [1] IS NOT DISTINCT FROM NULL
;
false

;
SELECT [1] IS DISTINCT FROM [2]
;
true

;
SELECT [1] IS DISTINCT FROM [1]
;
false

;
SELECT NULL IS DISTINCT FROM [1]
;
true

;
SELECT [1] IS DISTINCT FROM NULL
;
true

;
CREATE VIEW list_int1 AS SELECT * FROM (VALUES
	([1], [1]),
	([1], [2]),
	([2], [1]),
	(NULL, [1]),
	([2], NULL),
	(NULL, NULL)
	) tbl(l, r);

;
SELECT l IS NOT DISTINCT FROM r FROM list_int1
;
true
false
false
false
false
true

;
SELECT l IS DISTINCT FROM r FROM list_int1
;
false
true
true
true
true
false

# Constant multiple integer column distinctions

;
SELECT [1] IS NOT DISTINCT FROM [1, 2]
;
false

;
SELECT [1] IS NOT DISTINCT FROM [1]
;
true

;
SELECT NULL IS NOT DISTINCT FROM [1]
;
false

;
SELECT [1] IS NOT DISTINCT FROM NULL
;
false

;
SELECT [1] IS DISTINCT FROM [1, 2]
;
true

;
SELECT [1] IS DISTINCT FROM [1]
;
false

;
SELECT NULL IS DISTINCT FROM [1]
;
true

;
SELECT [1] IS DISTINCT FROM NULL
;
true

;
CREATE VIEW list_int AS SELECT * FROM (VALUES
	([1], [1]),
	([1], [1, 2]),
	([1, 2], [1]),
	(NULL, [1]),
	([1, 2], NULL),
	(NULL, NULL)
	) tbl(l, r);

;
SELECT l IS NOT DISTINCT FROM r FROM list_int
;
true
false
false
false
false
true

;
SELECT l IS DISTINCT FROM r FROM list_int
;
false
true
true
true
true
false

# Constant empty integer column distinctions

;
SELECT [] IS NOT DISTINCT FROM [1, 2]
;
false

;
SELECT [] IS NOT DISTINCT FROM []
;
true

;
SELECT NULL IS NOT DISTINCT FROM []
;
false

;
SELECT [] IS NOT DISTINCT FROM NULL
;
false

;
SELECT [] IS DISTINCT FROM [1, 2]
;
true

;
SELECT [] IS DISTINCT FROM []
;
false

;
SELECT NULL IS DISTINCT FROM []
;
true

;
SELECT [] IS DISTINCT FROM NULL
;
true

;
CREATE VIEW list_int_empty AS SELECT * FROM (VALUES
	([], []),
	([], [1, 2]),
	([1, 2], []),
	(NULL, []),
	([1, 2], NULL),
	(NULL, NULL)
	) tbl(l, r);

;
SELECT l IS NOT DISTINCT FROM r FROM list_int_empty
;
true
false
false
false
false
true

;
SELECT l IS DISTINCT FROM r FROM list_int_empty
;
false
true
true
true
true
false

# List of strings
;
SELECT ['duck'] IS NOT DISTINCT FROM ['duck', 'goose']
;
false

;
SELECT ['duck'] IS NOT DISTINCT FROM ['duck']
;
true

;
SELECT NULL IS NOT DISTINCT FROM ['duck']
;
false

;
SELECT ['duck'] IS NOT DISTINCT FROM NULL
;
false

;
SELECT ['duck'] IS DISTINCT FROM ['duck', 'goose']
;
true

;
SELECT ['duck'] IS DISTINCT FROM ['duck']
;
false

;
SELECT NULL IS DISTINCT FROM ['duck']
;
true

;
SELECT ['duck'] IS DISTINCT FROM NULL
;
true

;
CREATE VIEW list_str AS SELECT * FROM (VALUES
	(['duck'], ['duck']),
	(['duck'], ['duck', 'goose']),
	(['duck', 'goose'], ['duck']),
	(NULL, ['duck']),
	(['duck', 'goose'], NULL),
	(NULL, NULL)
	) tbl(l, r);

;
SELECT l IS NOT DISTINCT FROM r FROM list_str
;
true
false
false
false
false
true

;
SELECT l IS DISTINCT FROM r FROM list_str
;
false
true
true
true
true
false

# List of structs

;
SELECT [{'x': 'duck', 'y': 1}] IS NOT DISTINCT FROM [{'x': 'duck', 'y': 1}, {'x': 'goose', 'y': 2}]
;
false

;
SELECT [{'x': 'duck', 'y': 1}] IS NOT DISTINCT FROM [{'x': 'duck', 'y': 1}]
;
true

;
SELECT NULL IS NOT DISTINCT FROM [{'x': 'duck', 'y': 1}]
;
false

;
SELECT [{'x': 'duck', 'y': 1}] IS NOT DISTINCT FROM NULL
;
false

;
SELECT [{'x': 'duck', 'y': 1}] IS DISTINCT FROM [{'x': 'duck', 'y': 1}, {'x': 'goose', 'y': 2}]
;
true

;
SELECT [{'x': 'duck', 'y': 1}] IS DISTINCT FROM [{'x': 'duck', 'y': 1}]
;
false

;
SELECT NULL IS DISTINCT FROM [{'x': 'duck', 'y': 1}]
;
true

;
SELECT [{'x': 'duck', 'y': 1}] IS DISTINCT FROM NULL
;
true

;
CREATE VIEW list_of_struct AS SELECT * FROM (VALUES
	([{'x': 'duck', 'y': 1}], [{'x': 'duck', 'y': 1}]),
	([{'x': 'duck', 'y': 1}], [{'x': 'duck', 'y': 1}, {'x': 'goose', 'y': 2}]),
	([{'x': 'duck', 'y': 1}, {'x': 'goose', 'y': 2}], [{'x': 'duck', 'y': 1}]),
	(NULL, [{'x': 'duck', 'y': 1}]),
	([{'x': 'duck', 'y': 1}, {'x': 'goose', 'y': 2}], NULL),
	(NULL, NULL)
	) tbl(l, r);


;
SELECT l IS NOT DISTINCT FROM r FROM list_of_struct
;
true
false
false
false
false
true

;
SELECT l IS DISTINCT FROM r FROM list_of_struct
;
false
true
true
true
true
false

# Filter by constant
;
select CASE WHEN a < 4 THEN [a,a+1,a+2] ELSE NULL END IS NOT DISTINCT FROM [1,2,3] from range(5) tbl(a);
;
false
true
false
false
false

;
select CASE WHEN a < 4 THEN [a,a+1,a+2] ELSE NULL END IS DISTINCT FROM [1,2,3] from range(5) tbl(a);
;
true
false
true
true
true
