# name: test/sql/storage/test_update_delete_string.test
# description: Test updates/deletes and strings
# group: [storage]

# load the DB from disk
load __TEST_DIR__/test_string_update.db

# create a database and insert values
;
CREATE TABLE test (a INTEGER, b STRING);

;
INSERT INTO test VALUES (NULL, 'hello'), (13, 'abcdefgh'), (12, NULL)

;
SELECT a, b FROM test ORDER BY a
;
NULL	hello
12	NULL
13	abcdefgh

restart

;
PRAGMA enable_verification

;
SELECT a, b FROM test ORDER BY a
;
NULL	hello
12	NULL
13	abcdefgh

;
SELECT * FROM test WHERE a IS NULL
;
NULL	hello

;
UPDATE test SET b=NULL WHERE a IS NULL
;
1

;
SELECT * FROM test WHERE a IS NULL
;
NULL	NULL

;
SELECT a, b FROM test ORDER BY a
;
NULL	NULL
12	NULL
13	abcdefgh

restart

;
SELECT a, b FROM test ORDER BY a
;
NULL	NULL
12	NULL
13	abcdefgh

restart

;
DELETE FROM test WHERE a=12

restart

;
SELECT a, b FROM test ORDER BY a
;
NULL	NULL
13	abcdefgh

restart

;
SELECT a, b FROM test ORDER BY a
;
NULL	NULL
13	abcdefgh

;
INSERT INTO test VALUES (12, NULL)

;
SELECT a, b FROM test ORDER BY a
;
NULL	NULL
12	NULL
13	abcdefgh

restart

;
SELECT a, b FROM test ORDER BY a
;
NULL	NULL
12	NULL
13	abcdefgh

restart

;
SELECT a, b FROM test ORDER BY a
;
NULL	NULL
12	NULL
13	abcdefgh

;
UPDATE test SET b='test123' WHERE a=12

;
SELECT a, b FROM test ORDER BY a
;
NULL	NULL
12	test123
13	abcdefgh

restart

;
SELECT a, b FROM test ORDER BY a
;
NULL	NULL
12	test123
13	abcdefgh

;
UPDATE test SET a=a+1

;
SELECT a, b FROM test ORDER BY a
;
NULL	NULL
13	test123
14	abcdefgh

restart

;
SELECT a, b FROM test ORDER BY a
;
NULL	NULL
13	test123
14	abcdefgh
