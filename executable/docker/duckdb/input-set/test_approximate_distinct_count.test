# name: test/sql/aggregate/aggregates/test_approximate_distinct_count.test
# description: Test approx_count_distinct operator
# group: [aggregates]

;
select approx_count_distinct(*)

;
select approx_count_distinct(1)
;
1

;
select approx_count_distinct(NULL)
;
0

;
select approx_count_distinct('hello')
;
1

;
select approx_count_distinct(10), approx_count_distinct('hello') from range(100);
;
1	1

;
select approx_count_distinct(i) from range (100) tbl(i) WHERE 1 == 0;
;
0

;
CREATE TABLE IF NOT EXISTS dates (t date);

;
INSERT INTO dates VALUES ('2008-01-01'), (NULL), ('2007-01-01'), ('2008-02-01'), ('2008-01-02'), ('2008-01-01'), ('2008-01-01'), ('2008-01-01')

;
CREATE TABLE IF NOT EXISTS timestamp (t TIMESTAMP);

;
INSERT INTO timestamp VALUES ('2008-01-01 00:00:01'), (NULL), ('2007-01-01 00:00:01'), ('2008-02-01 00:00:01'), ('2008-01-02 00:00:01'), ('2008-01-01 10:00:00'), ('2008-01-01 00:10:00'), ('2008-01-01 00:00:10')

;
CREATE TABLE IF NOT EXISTS names (t string);

;
INSERT INTO names VALUES ('Pedro'), (NULL), ('Pedro'), ('Pedro'), ('Mark'), ('Mark'),('Mark'),('Hannes-Muehleisen'),('Hannes-Muehleisen')

# test counts on a set of values
;
create  table t as select range a, mod(range,10) b from range(2000);

;
SELECT COUNT( a),approx_count_distinct(a),approx_count_distinct(b) from t
;
2000	1990	10

;
SELECT approx_count_distinct(a) from t group by a %2;
;
1007
1003

require vector_size 512

;
SELECT count(*) from t where a < 10;
;
10

;
SELECT approx_count_distinct(a) over (partition by a%2) from t where a < 10;
;
5
5
5
5
5
5
5
5
5
5

;
SELECT COUNT( t),approx_count_distinct(t) from timestamp
;
7	7

;
SELECT COUNT( t),approx_count_distinct(t) from dates
;
7	4

;
SELECT COUNT(t),approx_count_distinct(t) from names
;
8	3

