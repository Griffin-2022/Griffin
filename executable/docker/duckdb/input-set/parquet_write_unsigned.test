# name: test/sql/copy/parquet/writer/parquet_write_unsigned.test
# description: Parquet unsigned types round trip
# group: [writer]

require parquet

;
PRAGMA enable_verification

;
CREATE TABLE values_UTINYINT AS SELECT d::UTINYINT d FROM (VALUES
    (0), (42), (NULL), (255)) tbl (d);

;
CREATE TABLE values_USMALLINT AS SELECT d::USMALLINT d FROM (VALUES
    (0), (42), (NULL), (65535)) tbl (d);

;
CREATE TABLE values_UINTEGER AS SELECT d::UINTEGER d FROM (VALUES
    (0), (42), (NULL), (4294967295)) tbl (d);

;
CREATE TABLE values_UBIGINT AS SELECT d::UBIGINT d FROM (VALUES
    (0), (42), (NULL), (18446744073709551615)) tbl (d);

foreach type UTINYINT USMALLINT UINTEGER UBIGINT

;
CREATE OR REPLACE TABLE unsigned(d ${type})

;
INSERT INTO unsigned SELECT * FROM values_${type}

;
COPY unsigned TO '__TEST_DIR__/unsigned.parquet' (FORMAT 'parquet');

;
SELECT * FROM '__TEST_DIR__/unsigned.parquet' EXCEPT SELECT * FROM unsigned
;

;
SELECT * FROM unsigned EXCEPT SELECT * FROM '__TEST_DIR__/unsigned.parquet'
;

;
SELECT * FROM '__TEST_DIR__/unsigned.parquet' WHERE d=42
;
42

;
SELECT COUNT(*) FROM '__TEST_DIR__/unsigned.parquet' WHERE d>42
;
1

;
SELECT COUNT(*) FROM '__TEST_DIR__/unsigned.parquet' WHERE d>=42
;
2

;
SELECT COUNT(*) FROM '__TEST_DIR__/unsigned.parquet' WHERE d<42
;
1

;
SELECT COUNT(*) FROM '__TEST_DIR__/unsigned.parquet' WHERE d<=42
;
2

;
SELECT typeof(d)='${type}' FROM '__TEST_DIR__/unsigned.parquet' LIMIT 1
;
true

endloop