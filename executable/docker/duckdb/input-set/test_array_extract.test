# name: test/sql/function/string/test_array_extract.test
# description: Substring test
# group: [string]

;
PRAGMA enable_verification

;
CREATE TABLE strings(s VARCHAR, off INTEGER);

;
INSERT INTO strings VALUES ('hello', 1), ('world', 2), ('b', 1), (NULL, 2)

# test zero length
;
SELECT array_extract('ðŸ¦†ab', 4), array_extract('abc', 4)
;
(empty)	(empty)

# constant offset/length
# normal array_extract
;
SELECT array_extract(s, 2) FROM strings
;
e
o
(empty)
NULL

# array_extract out of range
;
SELECT array_extract(s, 3) FROM strings
;
l
r
(empty)
NULL

# variable length offset/length
;
SELECT array_extract(s, off) FROM strings
;
h
o
b
NULL

;
SELECT array_extract(s, 2) FROM strings
;
e
o
(empty)
NULL

;
SELECT array_extract('hello', off) FROM strings
;
h
e
h
e

# test substrings with constant nulls in different places
;
SELECT array_extract(NULL::VARCHAR, off) FROM strings
;
NULL
NULL
NULL
NULL

;
SELECT array_extract('hello', NULL) FROM strings
;
NULL
NULL
NULL
NULL

;
SELECT array_extract(NULL::VARCHAR, NULL) FROM strings
;
NULL
NULL
NULL
NULL

;
SELECT array_extract(NULL::VARCHAR, off) FROM strings
;
NULL
NULL
NULL
NULL

;
SELECT array_extract(NULL::VARCHAR, NULL) FROM strings
;
NULL
NULL
NULL
NULL

# negative offset
;
SELECT array_extract(s, -1) FROM strings
;
o
d
b
NULL

# zero offset
;
SELECT array_extract(s, 1) FROM strings
;
h
w
b
NULL

# length 0
;
SELECT array_extract(s, 6) FROM strings
;
(empty)
(empty)
(empty)
NULL

# very large offset and length
;
SELECT array_extract(s, 2147483646) FROM strings
;
(empty)
(empty)
(empty)
NULL

;
SELECT array_extract(s, -2147483647) FROM strings
;
h
w
b
NULL
