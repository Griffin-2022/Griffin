# name: test/sql/index/art/index_large_abort.test
# description: Test abort of large insertion of negative values into index and verify that all elements are correctly deleted
# group: [art]

;
PRAGMA enable_verification

;
CREATE TABLE a(id INTEGER PRIMARY KEY, c INT);

;
INSERT INTO a VALUES (1, 4)

;
BEGIN TRANSACTION

;
INSERT INTO a SELECT i id, NULL c FROM range(-2, -250000, -1) tbl(i)

;
INSERT INTO a VALUES (1, 5)

;
ROLLBACK

;
SELECT c FROM a WHERE id=1
;
4

;
SELECT * FROM a
;
1	4

# now with non-null values
;
BEGIN TRANSACTION

;
INSERT INTO a SELECT i id, -i c FROM range(-2, -250000, -1) tbl(i)

;
INSERT INTO a VALUES (1, 5)

;
ROLLBACK

;
SELECT c FROM a WHERE id=1
;
4

;
SELECT * FROM a
;
1	4
