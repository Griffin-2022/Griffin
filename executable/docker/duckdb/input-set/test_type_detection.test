# name: test/sql/copy/csv/auto/test_type_detection.test
# description: Test csv type detection
# group: [auto]

require vector_size 512

# a CSV file with many strings
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/large_mixed_data.csv', SAMPLE_SIZE=-1);

;
SELECT linenr, mixed_string, mixed_double FROM test LIMIT 3;
;
1	1	1.000000
2	2	2.000000
3	3	3.000000

;
SELECT typeof(linenr), typeof(mixed_string), typeof(mixed_double) FROM test LIMIT 1;
;
INTEGER	VARCHAR	DOUBLE

;
SELECT linenr, mixed_string, mixed_double FROM test WHERE linenr > 27000 LIMIT 3;
;
27001	1	1.000000
27002	2	2.000000
27003	3	3.500000

;
SELECT count(*) FROM test;
;
27003

;
DROP TABLE test;

# a CSV file containing time, date and timestamp columns
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/time_date_timestamp.csv');

;
SELECT a, b, t, d, ts FROM test ORDER BY a;
;
123	TEST2	12:12:12	2000-01-01	2000-01-01 12:12:00
345	TEST2	14:15:30	2002-02-02	2002-02-02 14:15:00
346	TEST2	15:16:17	2004-12-13	2004-12-13 15:16:00


;
SELECT typeof(a), typeof(b), typeof(t), typeof(d), typeof(ts) FROM test LIMIT 1;
;
INTEGER	VARCHAR	TIME	DATE	TIMESTAMP

;
DROP TABLE test;

# a CSV file containing time and date columns with leading/trailing chars
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/time_date_timestamp_trailing.csv');

;
SELECT a, b, t, tf, d, df FROM test ORDER BY a;
;
123	TEST2	12:12:12	12:12:12	2000-01-01	2000-01-01
345	TEST2	14:15:30	14:15:30	2002-02-02	2000-01-01 a
346	TEST2	15:16:17	15:16:17 01	2004-12-13	2000-01-01

;
SELECT typeof(a), typeof(b), typeof(t), typeof(tf), typeof(d), typeof(df) FROM test LIMIT 1;
;
INTEGER	VARCHAR	TIME	VARCHAR	DATE	VARCHAR

;
DROP TABLE test;

# a CSV file containing time, date and timestamp columns in mm-dd-yyyy (12 hour)
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/time_date_timestamp_mm-dd-yyyy.csv');

;
SELECT a, b, t, d, ts FROM test ORDER BY a;
;
123	TEST2	12:12:12	2000-01-01	2000-01-01 00:12:00
345	TEST2	14:15:30	2002-02-02	2002-02-02 14:15:00
346	TEST2	15:16:17	2004-12-13	2004-12-13 15:16:00

;
SELECT typeof(a), typeof(b), typeof(t), typeof(d), typeof(ts) FROM test LIMIT 1;
;
INTEGER	VARCHAR	TIME	DATE	TIMESTAMP

;
DROP TABLE test;

# a CSV file containing time, date and timestamp columns in mm-dd-yy format (12 hour)
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/time_date_timestamp_mm-dd-yy.csv');

;
SELECT a, b, t, d, ts FROM test ORDER BY a;
;
123	TEST2	12:12:12	1990-01-01	1990-01-01 00:12:00
345	TEST2	14:15:30	2002-02-02	2002-02-02 14:15:00
346	TEST2	15:16:17	2004-12-13	2004-12-13 15:16:00

;
SELECT typeof(a), typeof(b), typeof(t), typeof(d), typeof(ts) FROM test LIMIT 1;
;
INTEGER	VARCHAR	TIME	DATE	TIMESTAMP

;
DROP TABLE test;

# a CSV file containing time, date and timestamp columns in dd-mm-yyyy format
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/time_date_timestamp_dd-mm-yyyy.csv');

;
SELECT a, b, t, d, ts FROM test ORDER BY a;
;
123	TEST2	12:12:12	2000-01-01	2000-01-01 12:12:00
345	TEST2	14:15:30	2002-02-02	2002-02-02 14:15:00
346	TEST2	15:16:17	2004-12-13	2004-12-13 15:16:00

;
SELECT typeof(a), typeof(b), typeof(t), typeof(d), typeof(ts) FROM test LIMIT 1;
;
INTEGER	VARCHAR	TIME	DATE	TIMESTAMP

;
DROP TABLE test;

# a CSV file containing time, date and timestamp columns in dd-mm-yy format
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/time_date_timestamp_dd-mm-yy.csv');

;
SELECT a, b, t, d, ts FROM test ORDER BY a;
;
123	TEST2	12:12:12	2000-01-01	1990-01-01 12:12:00
345	TEST2	14:15:30	2002-02-02	2002-02-02 14:15:00
346	TEST2	15:16:17	2004-12-13	2004-12-13 15:16:00

;
SELECT typeof(a), typeof(b), typeof(t), typeof(d), typeof(ts) FROM test LIMIT 1;
;
INTEGER	VARCHAR	TIME	DATE	TIMESTAMP

;
DROP TABLE test;

# a CSV file containing time, date and timestamp columns in yyyy.mm.dd format
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/time_date_timestamp_yyyy.mm.dd.csv');

;
SELECT a, b, t, d, ts FROM test ORDER BY a;
;
123	TEST2	12:12:12	2000-01-01	2000-01-01 12:12:00
345	TEST2	14:15:30	2002-02-02	2002-02-02 14:15:00
346	TEST2	15:16:17	2004-12-13	2004-12-13 15:16:00


;
SELECT typeof(a), typeof(b), typeof(t), typeof(d), typeof(ts) FROM test LIMIT 1;
;
INTEGER	VARCHAR	TIME	DATE	TIMESTAMP

;
DROP TABLE test;

# a CSV file containing time, date and timestamp columns in yy.mm.dd format
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/time_date_timestamp_yy.mm.dd.csv');

;
SELECT a, b, t, d, ts FROM test ORDER BY a;
;
123	TEST2	12:12:12	1990-01-01	1990-01-01 00:12:00
345	TEST2	14:15:30	2002-02-02	2002-02-02 14:15:00
346	TEST2	15:16:17	2004-12-13	2004-12-13 15:16:00

;
SELECT typeof(a), typeof(b), typeof(t), typeof(d), typeof(ts) FROM test LIMIT 1;
;
INTEGER	VARCHAR	TIME	DATE	TIMESTAMP

;
DROP TABLE test;

# a CSV file containing integer bool value
;
CREATE TABLE test AS SELECT * FROM read_csv_auto ('test/sql/copy/csv/data/auto/int_bol.csv');

;
SELECT i FROM test ORDER BY i;
;
1
2
3
4

;
SELECT typeof(i), typeof(b) FROM test LIMIT 1;
;
INTEGER	BOOLEAN

;
DROP TABLE test;

