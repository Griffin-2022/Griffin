# name: test/sql/copy/parquet/parquet_external_access.test
# description: Test that enable_external_access blocks Parquet reads
# group: [parquet]

require parquet

# we cannot read parquet files
;
CREATE TABLE lineitem AS SELECT * FROM 'data/parquet-testing/arrow/lineitem-arrow.parquet'

;
SET enable_external_access=false;

# we cannot read parquet files
;
SELECT * FROM 'data/parquet-testing/arrow/lineitem-arrow.parquet'

# or their metadata
;
SELECT * FROM parquet_metadata('data/parquet-testing/arrow/lineitem-arrow.parquet')

;
SELECT * FROM parquet_schema('data/parquet-testing/arrow/lineitem-arrow.parquet')

# also not in a list
;
SELECT * FROM parquet_scan(['data/parquet-testing/arrow/lineitem-arrow.parquet', 'data/parquet-testing/arrow/lineitem-arrow.parquet'])

# neither can we glob
;
SELECT * FROM glob('data/parquet-testing/arrow/lineitem-arrow.parquet')

# or copy to/from...
;
COPY lineitem FROM 'data/parquet-testing/arrow/lineitem-arrow.parquet'

;
COPY lineitem TO '__TEST_DIR__/lineitem.parquet'

# we also can't just enable external access again
;
SET enable_external_access=true;
