# name: test/sql/aggregate/aggregates/test_histogram.test
# description: Test histogram aggregation
# group: [aggregates]

;
PRAGMA enable_verification

;
select histogram(NULL)
;
NULL

# Empty Table
;
SELECT histogram(i) FROM range(100) tbl(i) WHERE 1=0;
;
NULL

;
select histogram(1)
;
{1=1}

;
SELECT histogram(2) FROM range(100);
;
{2=100}

;
CREATE TABLE hist_data (g INTEGER, e INTEGER)

;
INSERT INTO hist_data VALUES (1, 1), (1, 2), (2, 3), (2, 4), (2, 5), (3, 6), (5, NULL)


;
SELECT histogram(g) from hist_data
;
{1=2, 2=3, 3=1, 5=1}

;
SELECT histogram(e) from hist_data
;
{1=1, 2=1, 3=1, 4=1, 5=1, 6=1}

;
select histogram(g)
    from hist_data
    group by g%2==0 ORDER BY g%2==0
;
{1=2, 3=1, 5=1}
{2=3}

;
select histogram(g)
    from hist_data
    where g < 3
;
{1=2, 2=3}

;
create table names (name string)

;
insert into names values ('pedro'), ('pedro'), ('pedro'),('hannes'),('hannes'),('mark'),(null),('Hubert Blaine Wolfeschlegelsteinhausenbergerdorff Sr.');

;
select histogram(name) from names;
;
{Hubert Blaine Wolfeschlegelsteinhausenbergerdorff Sr.=1, hannes=2, mark=1, pedro=3}

# Variant time type binding (Issue #3290)
;
SELECT histogram(CAST('2021-08-20' AS TIMESTAMP_S));
;
{2021-08-20 00:00:00=1}

;
SELECT histogram(CAST('2021-08-20' AS TIMESTAMP_MS));
;
{2021-08-20 00:00:00=1}

;
SELECT histogram(CAST('2021-08-20' AS TIMESTAMP_NS));
;
{2021-08-20 00:00:00=1}

require vector_size 512

;
select g,histogram(g) over (partition by g%2)
    from hist_data;
;
1	{1=2, 3=1, 5=1}
1	{1=2, 3=1, 5=1}
2	{2=3}
2	{2=3}
2	{2=3}
3	{1=2, 3=1, 5=1}
5	{1=2, 3=1, 5=1}

#Corner cases
;
select histogram()

;
select histogram(*)
