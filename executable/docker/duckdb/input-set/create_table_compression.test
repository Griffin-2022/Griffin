# name: test/sql/create/create_table_compression.test
# description: Test CREATE TABLE using Compression Option
# group: [create]

;
PRAGMA enable_verification

;
CREATE TABLE T (a INTEGER USING COMPRESSION RLE)

;
DROP TABLE T

;
CREATE TABLE T (a INTEGER USING COMPRESSION 'bla')

;
CREATE TABLE T (a INTEGER USING COMPRESSION )

;
CREATE TABLE T (a INTEGER NOT NULL USING COMPRESSION )

;
CREATE TABLE T (a INTEGER USING COMPRESSION bla)

;
CREATE TABLE T (a INTEGER NOT NULL USING COMPRESSION RLE)


;
DROP TABLE T

;
CREATE TABLE T (a INTEGER USING COMPRESSION RLE, b VARCHAR USING COMPRESSION RLE )

;
DROP TABLE T

;
CREATE TABLE T (a INTEGER USING COMPRESSION RLE, b VARCHAR )

;
DROP TABLE T

# load the DB from disk
load __TEST_DIR__/test_compression_hint.db

;
CREATE TABLE T (a INTEGER USING COMPRESSION RLE, b INTEGER USING COMPRESSION BITPACKING, C INTEGER USING COMPRESSION UNCOMPRESSED)

;
INSERT INTO T VALUES (1,1,1), (1,1,1), (1,1,1), (2,2,2), (2,2,2), (3,3,3)

;
SELECT * FROM T
;
1	1	1
1	1	1
1	1	1
2	2	2
2	2	2
3	3	3

restart

;
SELECT * FROM T
;
1	1	1
1	1	1
1	1	1
2	2	2
2	2	2
3	3	3

;
SELECT compression FROM pragma_storage_info('T') WHERE segment_type ILIKE 'INTEGER' LIMIT 3
;
RLE
BitPacking
Uncompressed

;
ALTER TABLE T RENAME COLUMN a TO a_1


;
ALTER TABLE T RENAME COLUMN b TO b_1

;
ALTER TABLE T RENAME COLUMN c TO c_1

restart

;
SELECT * FROM T
;
1	1	1
1	1	1
1	1	1
2	2	2
2	2	2
3	3	3

;
SELECT compression FROM pragma_storage_info('T') WHERE segment_type ILIKE 'INTEGER' LIMIT 3
;
RLE
BitPacking
Uncompressed

;
ALTER TABLE T RENAME TO T_1

restart

;
SELECT * FROM T_1
;
1	1	1
1	1	1
1	1	1
2	2	2
2	2	2
3	3	3

;
SELECT compression FROM pragma_storage_info('T_1') WHERE segment_type ILIKE 'INTEGER' LIMIT 3
;
RLE
BitPacking
Uncompressed

# Test Drop Column
;
ALTER TABLE T_1 DROP COLUMN c_1

;
ALTER TABLE T_1 DROP COLUMN b_1

restart

;
SELECT * FROM T_1
;
1
1
1
2
2
3

;
SELECT compression FROM pragma_storage_info('T_1') WHERE segment_type ILIKE 'INTEGER' LIMIT 2
;
RLE

# Test Add Column
;
ALTER TABLE T_1 ADD COLUMN b INTEGER DEFAULT 2

restart

;
SELECT * FROM T_1
;
1	2
1	2
1	2
2	2
2	2
3	2

;
SELECT compression FROM pragma_storage_info('T_1') WHERE segment_type ILIKE 'INTEGER' LIMIT 3
;
RLE
Constant