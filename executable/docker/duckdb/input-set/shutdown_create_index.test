# name: test/sql/storage/shutdown_create_index.test
# description: CREATE INDEX statement after shutdown
# group: [storage]

# load the DB from disk
load __TEST_DIR__/shutdown_create_index.db

;
CREATE TABLE test (a INTEGER, b INTEGER);

;
INSERT INTO test VALUES (11, 22), (13, 22);

# perform some inserts and deletions + create an index,

loop i 0 2

restart

;
SELECT * FROM test ORDER BY a
;
11	22
13	22

;
INSERT INTO test VALUES (11, 24)

;
CREATE INDEX i_index ON test using art(a)

;
SELECT a, b FROM test WHERE a=11 ORDER BY b
;
11	22
11	24

;
SELECT a, b FROM test WHERE a>11 ORDER BY b
;
13	22

;
DELETE FROM test WHERE a=11 AND b=24

;
SELECT * FROM test ORDER BY a
;
11	22
13	22

endloop

# now with updates
loop i 0 2

restart

;
SELECT * FROM test ORDER BY a
;
11	22
13	22

;
INSERT INTO test VALUES (11, 24)

;
CREATE INDEX i_index ON test using art(a)

;
SELECT a, b FROM test WHERE a=11 ORDER BY b
;
11	22
11	24

;
SELECT a, b FROM test WHERE a>11 ORDER BY b
;
13	22

;
DELETE FROM test WHERE a=11 AND b=22

;
UPDATE test SET b=22 WHERE a=11

;
SELECT * FROM test ORDER BY a
;
11	22
13	22

endloop
