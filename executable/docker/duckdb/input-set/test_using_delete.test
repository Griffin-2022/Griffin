# name: test/sql/delete/test_using_delete.test
# description: Test deletions with USING clause
# group: [delete]

;
PRAGMA enable_verification;

;
CREATE TABLE a(i INTEGER);

;
INSERT INTO a VALUES (1), (2), (3);

;
DELETE FROM a USING (values (1)) tbl(i) WHERE a.i=tbl.i;
;
1

;
SELECT * FROM a;
;
2
3

# no condition?
;
DELETE FROM a USING (values (1)) tbl(i);
;
2

;
SELECT * FROM a;
;

;
INSERT INTO a VALUES (1), (2), (3);

;
SELECT * FROM a;
;
1
2
3

# multiple joins
;
DELETE FROM a USING (values (1)) tbl(i), (values (1), (2)) tbl2(i) WHERE a.i=tbl.i AND a.i=tbl2.i;
;
1

;
SELECT * FROM a;
;
2
3

# no matches
;
DELETE FROM a USING (values (4)) tbl(i) WHERE a.i=tbl.i;
;
0

;
SELECT * FROM a;
;
2
3

# self join
;
DELETE FROM a USING a a2(i) WHERE a.i>a2.i;
;
1

;
SELECT * FROM a;
;
2

# binding errors
# table does not exist
;
DELETE FROM a USING b WHERE a.i=b.i;

# column does not exist
;
DELETE FROM a USING a b WHERE a.i=b.j;
