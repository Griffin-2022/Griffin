# name: test/sql/index/art/test_many_versions.test
# description: Test ART index creation with many versions
# group: [art]

# insert the values [1...20001]
;
CREATE TABLE integers(i INTEGER)

;
INSERT INTO integers SELECT * FROM range(1, 20001, 1)

# now start a transaction in con2
;
BEGIN TRANSACTION

# increment values by 1
;
UPDATE integers SET i=i+1

# now start a transaction in con3
;
BEGIN TRANSACTION

# increment values by 1 again
;
UPDATE integers SET i=i+1

# now start a transaction in con4
;
BEGIN TRANSACTION

# increment values by 1 again
;
UPDATE integers SET i=i+1

# create an index, this fails because we have outstanding updates
;
CREATE INDEX i_index ON integers using art(i)

# con2
;
SELECT SUM(i) FROM integers
;
200010000.000000

;
SELECT SUM(i) FROM integers WHERE i > 0
;
200010000.000000

# con3
;
SELECT SUM(i) FROM integers
;
200030000.000000

;
SELECT SUM(i) FROM integers WHERE i > 0
;
200030000.000000

# con4
;
SELECT SUM(i) FROM integers
;
200050000.000000

;
SELECT SUM(i) FROM integers WHERE i > 0
;
200050000.000000

# total sum
;
SELECT SUM(i) FROM integers
;
200070000.000000

;
SELECT SUM(i) FROM integers WHERE i > 0
;
200070000.000000

