# name: test/sql/update/null_update_merge_transaction.test
# description: Test repeated updates that change the nullness of values
# group: [update]

# create a table
;
CREATE TABLE test (id INTEGER, a INTEGER);

;
INSERT INTO test VALUES (1, 1), (2, 2), (3, 3), (4, NULL);

;
SELECT * FROM test ORDER BY id;
;
1	1
2	2
3	3
4	NULL

;
BEGIN TRANSACTION

;
UPDATE test SET a=CASE WHEN a IS NULL THEN 1 ELSE NULL END

;
SELECT * FROM test ORDER BY id;
;
1	NULL
2	NULL
3	NULL
4	1

;
UPDATE test SET a=2 WHERE id >= 2 AND id <= 3

;
SELECT * FROM test ORDER BY id;
;
1	NULL
2	2
3	2
4	1

;
UPDATE test SET a=NULL WHERE id >= 3

;
SELECT * FROM test ORDER BY id;
;
1	NULL
2	2
3	NULL
4	NULL

;
UPDATE test SET a=id WHERE id != 3

;
SELECT * FROM test ORDER BY id;
;
1	1
2	2
3	NULL
4	4

;
UPDATE test SET a=NULL WHERE id != 3

;
SELECT * FROM test ORDER BY id;
;
1	NULL
2	NULL
3	NULL
4	NULL

;
UPDATE test SET a=3 WHERE id != 2

;
SELECT * FROM test ORDER BY id;
;
1	3
2	NULL
3	3
4	3

;
UPDATE test SET a=7 WHERE id != 3

;
SELECT * FROM test ORDER BY id;
;
1	7
2	7
3	3
4	7

;
UPDATE test SET a=NULL

;
SELECT * FROM test ORDER BY id;
;
1	NULL
2	NULL
3	NULL
4	NULL

;
COMMIT

;
SELECT * FROM test ORDER BY id;
;
1	NULL
2	NULL
3	NULL
4	NULL
