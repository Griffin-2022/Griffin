# name: test/sql/setops/test_full_outer_join_union.test
# description: Test full outer joins on unions
# group: [setops]

;
PRAGMA enable_verification;

;
CREATE TABLE integers(i INTEGER);

;
INSERT INTO integers VALUES (1), (2);

;
CREATE TABLE integers2(i INTEGER);

;
INSERT INTO integers2 VALUES (2), (3);

;
CREATE VIEW v1 AS SELECT * FROM integers UNION ALL SELECT * FROM integers;

;
CREATE VIEW v2 AS SELECT * FROM integers2 UNION ALL SELECT * FROM integers2;

;
SELECT COUNT(*) FROM v1 JOIN v2 USING (i);
;
4

;
SELECT COUNT(*) FROM v1 LEFT JOIN v2 USING (i);
;
6

;
SELECT COUNT(*) FROM v1 RIGHT JOIN v2 USING (i);
;
6

;
SELECT COUNT(*) FROM v1 FULL OUTER JOIN v2 USING (i);
;
8

# self joins
;
SELECT COUNT(*) FROM v1 JOIN v1 v2 USING (i);
;
8

;
SELECT COUNT(*) FROM v1 FULL OUTER JOIN v1 v2 USING (i);
;
8

# add some correlated subqueries for good measure
;
CREATE VIEW v3 AS SELECT (SELECT integers2.i-1) i FROM integers2 UNION ALL SELECT (SELECT integers2.i-1) i FROM integers2;

;
CREATE VIEW v4 AS SELECT (SELECT integers.i+1) i FROM integers UNION ALL SELECT (SELECT integers.i+1) i FROM integers;

;
SELECT COUNT(*) FROM v3
;
4

;
SELECT COUNT(*) FROM v4
;
4

;
SELECT COUNT(*) FROM v3 JOIN v4 USING (i);
;
4

;
SELECT COUNT(*) FROM v3 LEFT JOIN v4 USING (i);
;
6

;
SELECT COUNT(*) FROM v3 RIGHT JOIN v4 USING (i);
;
6

;
SELECT COUNT(*) FROM v3 FULL OUTER JOIN v4 USING (i);
;
8