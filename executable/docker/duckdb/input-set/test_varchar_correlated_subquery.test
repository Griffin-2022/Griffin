# name: test/sql/subquery/scalar/test_varchar_correlated_subquery.test
# description: Test varchar correlated subqueries
# group: [scalar]

;
PRAGMA enable_verification

# varchar tests
;
CREATE TABLE strings(v VARCHAR)

;
INSERT INTO strings VALUES ('hello'), ('world'), (NULL)

# ANY
;
SELECT NULL IN (SELECT * FROM strings WHERE v=s1.v) FROM strings s1 ORDER BY v
;
0
NULL
NULL

;
SELECT 3 IN (SELECT * FROM strings WHERE v=s1.v) FROM strings s1 ORDER BY v
;
0
0
0

;
SELECT 'hello' IN (SELECT * FROM strings WHERE v=s1.v) FROM strings s1 ORDER BY v
;
0
1
0

;
SELECT 'bla' IN (SELECT * FROM strings WHERE v=s1.v) FROM strings s1 ORDER BY v
;
0
0
0

;
SELECT 'hello' IN (SELECT * FROM strings WHERE v=s1.v or v IS NULL) FROM strings s1 ORDER BY v
;
NULL
1
NULL

;
SELECT 'bla' IN (SELECT * FROM strings WHERE v=s1.v or v IS NULL) FROM strings s1 ORDER BY v
;
NULL
NULL
NULL

# EXISTS
;
SELECT * FROM strings WHERE EXISTS(SELECT NULL, v) ORDER BY v
;
NULL
hello
world

;
SELECT * FROM strings s1 WHERE EXISTS(SELECT v FROM strings WHERE v=s1.v OR v IS NULL) ORDER BY v
;
NULL
hello
world

;
SELECT * FROM strings s1 WHERE EXISTS(SELECT v FROM strings WHERE v=s1.v) ORDER BY v
;
hello
world

#  scalar query
;
SELECT (SELECT v FROM strings WHERE v=s1.v) FROM strings s1 ORDER BY v
;
NULL
hello
world

;
SELECT (SELECT v FROM strings WHERE v=s1.v OR (v='hello' AND s1.v IS NULL)) FROM strings s1 ORDER BY v
;
hello
hello
world

