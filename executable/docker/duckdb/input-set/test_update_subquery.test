# name: test/sql/subquery/scalar/test_update_subquery.test
# description: Test subqueries in update
# group: [scalar]

;
PRAGMA enable_verification

;
CREATE TABLE integers(id INTEGER, i INTEGER)

;
INSERT INTO integers VALUES (1, 1), (2, 2), (3, 3), (4, NULL)

# correlated subquery in update
;
UPDATE integers i1 SET i=(SELECT MAX(i) FROM integers WHERE i1.i<>i)

;
SELECT id, i FROM integers ORDER BY id
;
1	3
2	3
3	2
4	NULL

# uncorrelated subquery in update
;
UPDATE integers i1 SET i=(SELECT MAX(i) FROM integers) WHERE i=(SELECT MIN(i) FROM integers)

;
SELECT id, i FROM integers ORDER BY id
;
1	3
2	3
3	3
4	NULL

# use different correlated column in subquery
;
UPDATE integers i1 SET i=(SELECT MAX(id) FROM integers WHERE id<i1.id)

;
SELECT id, i FROM integers ORDER BY id
;
1	NULL
2	1
3	2
4	3

# correlated subquery in WHERE
;
UPDATE integers i1 SET i=2 WHERE i<(SELECT MAX(id) FROM integers WHERE i1.id<id);

;
SELECT id, i FROM integers ORDER BY id
;
1	NULL
2	2
3	2
4	3

# use DEFAULT with correlated subquery in WHERE
;
UPDATE integers i1 SET i=DEFAULT WHERE i=(SELECT MIN(i) FROM integers WHERE i1.id<id);

;
SELECT id, i FROM integers ORDER BY id
;
1	NULL
2	NULL
3	2
4	3

