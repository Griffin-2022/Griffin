Warning: AFL++ tools might need to set AFL_MAP_SIZE to 1234115 to be able to run this instrumented program if this crashes!
AFL init.
=================================================================
==16281==ERROR: AddressSanitizer: heap-use-after-free on address 0x611000028600 at pc 0x000000b935c7 bp 0x7ffe41d1bf60 sp 0x7ffe41d1bf58
READ of size 1 at 0x611000028600 thread T0
    #0 0xb935c6 in std::__atomic_base<bool>::load(std::memory_order) const /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/atomic_base.h:419:9
    #1 0xb935c6 in std::atomic<bool>::operator bool() const /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/atomic:88:22
    #2 0xd92c0b in duckdb::DataTable::InitializeAppend(duckdb::Transaction&, duckdb::TableAppendState&, unsigned long) /root/duckdb/src/storage/data_table.cpp:493:7
    #3 0xdd9b83 in duckdb::LocalStorage::Flush(duckdb::DataTable&, duckdb::LocalTableStorage&) /root/duckdb/src/storage/local_storage.cpp:375:8
    #4 0xde091b in duckdb::LocalStorage::Commit(duckdb::LocalStorage::CommitState&, duckdb::Transaction&, duckdb::WriteAheadLog*, unsigned long) /root/duckdb/src/storage/local_storage.cpp:417:3
    #5 0x104399e in duckdb::Transaction::Commit[abi:cxx11](duckdb::DatabaseInstance&, unsigned long, bool) /root/duckdb/src/transaction/transaction.cpp:112:11
    #6 0x103f67c in duckdb::TransactionManager::CommitTransaction[abi:cxx11](duckdb::ClientContext&, duckdb::Transaction*) /root/duckdb/src/transaction/transaction_manager.cpp:206:30
    #7 0x103e21c in duckdb::TransactionContext::Commit() /root/duckdb/src/transaction/transaction_context.cpp:32:37
    #8 0x898bccc in duckdb::PhysicalTransaction::GetData(duckdb::ExecutionContext&, duckdb::DataChunk&, duckdb::GlobalSourceState&, duckdb::LocalSourceState&) const /root/duckdb/src/execution/operator/helper/physical_transaction.cpp:29:23
    #9 0xbb11e6 in duckdb::PipelineExecutor::FetchFromSource(duckdb::DataChunk&) /root/duckdb/src/parallel/pipeline_executor.cpp:316:19
    #10 0xb8fec8 in duckdb::PipelineExecutor::ExecutePull(duckdb::DataChunk&) /root/duckdb/src/parallel/pipeline_executor.cpp:194:5
    #11 0xb8eac0 in duckdb::Executor::FetchChunk() /root/duckdb/src/parallel/executor.cpp:698:18
    #12 0x76dbad in duckdb::ClientContext::FetchInternal(duckdb::ClientContextLock&, duckdb::Executor&, duckdb::BaseQueryResult&) /root/duckdb/src/main/client_context.cpp:99:25
    #13 0x779078 in duckdb::ClientContext::FetchResultInternal(duckdb::ClientContextLock&, duckdb::PendingQueryResult&, bool) /root/duckdb/src/main/client_context.cpp:230:16
    #14 0x79635c in duckdb::PendingQueryResult::ExecuteInternal(duckdb::ClientContextLock&, bool) /root/duckdb/src/main/pending_query_result.cpp:55:25
    #15 0x797a91 in duckdb::ClientContext::ExecutePendingQueryInternal(duckdb::ClientContextLock&, duckdb::PendingQueryResult&, bool) /root/duckdb/src/main/client_context.cpp:703:15
    #16 0x6a74ad in duckdb::ClientContext::Query(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, bool) /root/duckdb/src/main/client_context.cpp:642:21
    #17 0x6ac75f in duckdb::Connection::Query(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) /root/duckdb/src/main/connection.cpp:67:25
    #18 0x5b764e in duckdb_query /root/duckdb/src/main/capi/duckdb-c.cpp:67:22
    #19 0x59cdc3 in run_one_statement_new(void*, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) /mnt/jingzhou_workspace/sqlsim/client_new/duckdb/client_new.cpp:68:13
    #20 0x57b433 in run_testcase(void*&, char const*, int) /root/autodriver.cpp:135:14
    #21 0x57f845 in do_fuzz()::$_3::operator()() const /root/autodriver.cpp:295:13
    #22 0x57f13e in do_fuzz() /root/autodriver.cpp:303:13
    #23 0x57ff53 in main /root/autodriver.cpp:365:9
    #24 0x7fc34c01b082 in __libc_start_main /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308:16
    #25 0x4cc3fd in _start (/root/autodriver_afl_asan_debug+0x4cc3fd)

0x611000028600 is located 192 bytes inside of 200-byte region [0x611000028540,0x611000028608)
freed by thread T0 here:
    #0 0x578bdd in operator delete(void*) (/root/autodriver_afl_asan_debug+0x578bdd)
    #1 0x3995ff2 in __gnu_cxx::new_allocator<std::_Sp_counted_ptr_inplace<duckdb::DataTable, std::allocator<duckdb::DataTable>, (__gnu_cxx::_Lock_policy)2> >::deallocate(std::_Sp_counted_ptr_inplace<duckdb::DataTable, std::allocator<duckdb::DataTable>, (__gnu_cxx::_Lock_policy)2>*, unsigned long) /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/ext/new_allocator.h:128:2
    #2 0x3995f12 in std::allocator_traits<std::allocator<std::_Sp_counted_ptr_inplace<duckdb::DataTable, std::allocator<duckdb::DataTable>, (__gnu_cxx::_Lock_policy)2> > >::deallocate(std::allocator<std::_Sp_counted_ptr_inplace<duckdb::DataTable, std::allocator<duckdb::DataTable>, (__gnu_cxx::_Lock_policy)2> >&, std::_Sp_counted_ptr_inplace<duckdb::DataTable, std::allocator<duckdb::DataTable>, (__gnu_cxx::_Lock_policy)2>*, unsigned long) /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/alloc_traits.h:469:13
    #3 0x3991d06 in std::__allocated_ptr<std::allocator<std::_Sp_counted_ptr_inplace<duckdb::DataTable, std::allocator<duckdb::DataTable>, (__gnu_cxx::_Lock_policy)2> > >::~__allocated_ptr() /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/allocated_ptr.h:73:4
    #4 0x399348a in std::_Sp_counted_ptr_inplace<duckdb::DataTable, std::allocator<duckdb::DataTable>, (__gnu_cxx::_Lock_policy)2>::_M_destroy() /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/shared_ptr_base.h:567:7
    #5 0x3996cac in std::__shared_ptr<duckdb::DataTable, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr() /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/shared_ptr_base.h:1169:31
    #6 0x390ed48 in std::shared_ptr<duckdb::DataTable>::~shared_ptr() /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/shared_ptr.h:103:11
    #7 0x3947c64 in duckdb::TableCatalogEntry::~TableCatalogEntry() /root/duckdb/src/include/duckdb/catalog/catalog_entry/table_catalog_entry.hpp:33:7
    #8 0x3947d58 in duckdb::TableCatalogEntry::~TableCatalogEntry() /root/duckdb/src/include/duckdb/catalog/catalog_entry/table_catalog_entry.hpp:33:7
    #9 0x10976bb in std::default_delete<duckdb::CatalogEntry>::operator()(duckdb::CatalogEntry*) const /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/unique_ptr.h:81:2
    #10 0x1096f8a in std::unique_ptr<duckdb::CatalogEntry, std::default_delete<duckdb::CatalogEntry> >::~unique_ptr() /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/unique_ptr.h:292:4
    #11 0x39d297d in duckdb::CatalogSet::AlterEntry(duckdb::ClientContext&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, duckdb::AlterInfo*) /root/duckdb/src/catalog/catalog_set.cpp:209:1
    #12 0x38fe597 in duckdb::SchemaCatalogEntry::Alter(duckdb::ClientContext&, duckdb::AlterInfo*) /root/duckdb/src/catalog/catalog_entry/schema_catalog_entry.cpp:223:12
    #13 0x39eca94 in duckdb::Catalog::Alter(duckdb::ClientContext&, duckdb::AlterInfo*) /root/duckdb/src/catalog/catalog.cpp:375:24
    #14 0x8a245ae in duckdb::PhysicalAlter::GetData(duckdb::ExecutionContext&, duckdb::DataChunk&, duckdb::GlobalSourceState&, duckdb::LocalSourceState&) const /root/duckdb/src/execution/operator/schema/physical_alter.cpp:29:10
    #15 0xbb11e6 in duckdb::PipelineExecutor::FetchFromSource(duckdb::DataChunk&) /root/duckdb/src/parallel/pipeline_executor.cpp:316:19
    #16 0xb8fec8 in duckdb::PipelineExecutor::ExecutePull(duckdb::DataChunk&) /root/duckdb/src/parallel/pipeline_executor.cpp:194:5
    #17 0xb8eac0 in duckdb::Executor::FetchChunk() /root/duckdb/src/parallel/executor.cpp:698:18
    #18 0x76dbad in duckdb::ClientContext::FetchInternal(duckdb::ClientContextLock&, duckdb::Executor&, duckdb::BaseQueryResult&) /root/duckdb/src/main/client_context.cpp:99:25
    #19 0x779078 in duckdb::ClientContext::FetchResultInternal(duckdb::ClientContextLock&, duckdb::PendingQueryResult&, bool) /root/duckdb/src/main/client_context.cpp:230:16
    #20 0x79635c in duckdb::PendingQueryResult::ExecuteInternal(duckdb::ClientContextLock&, bool) /root/duckdb/src/main/pending_query_result.cpp:55:25
    #21 0x797a91 in duckdb::ClientContext::ExecutePendingQueryInternal(duckdb::ClientContextLock&, duckdb::PendingQueryResult&, bool) /root/duckdb/src/main/client_context.cpp:703:15
    #22 0x6a74ad in duckdb::ClientContext::Query(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, bool) /root/duckdb/src/main/client_context.cpp:642:21
    #23 0x6ac75f in duckdb::Connection::Query(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) /root/duckdb/src/main/connection.cpp:67:25
    #24 0x5b764e in duckdb_query /root/duckdb/src/main/capi/duckdb-c.cpp:67:22
    #25 0x59cdc3 in run_one_statement_new(void*, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) /mnt/jingzhou_workspace/sqlsim/client_new/duckdb/client_new.cpp:68:13
    #26 0x57b433 in run_testcase(void*&, char const*, int) /root/autodriver.cpp:135:14
    #27 0x57f845 in do_fuzz()::$_3::operator()() const /root/autodriver.cpp:295:13
    #28 0x57ff53 in main /root/autodriver.cpp:365:9
    #29 0x7fc34c01b082 in __libc_start_main /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308:16

previously allocated by thread T0 here:
    #0 0x57837d in operator new(unsigned long) (/root/autodriver_afl_asan_debug+0x57837d)
    #1 0x3992317 in __gnu_cxx::new_allocator<std::_Sp_counted_ptr_inplace<duckdb::DataTable, std::allocator<duckdb::DataTable>, (__gnu_cxx::_Lock_policy)2> >::allocate(unsigned long, void const*) /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/ext/new_allocator.h:114:27
    #2 0x399200a in std::allocator_traits<std::allocator<std::_Sp_counted_ptr_inplace<duckdb::DataTable, std::allocator<duckdb::DataTable>, (__gnu_cxx::_Lock_policy)2> > >::allocate(std::allocator<std::_Sp_counted_ptr_inplace<duckdb::DataTable, std::allocator<duckdb::DataTable>, (__gnu_cxx::_Lock_policy)2> >&, unsigned long) /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/alloc_traits.h:443:20
    #3 0x3990e04 in std::__allocated_ptr<std::allocator<std::_Sp_counted_ptr_inplace<duckdb::DataTable, std::allocator<duckdb::DataTable>, (__gnu_cxx::_Lock_policy)2> > > std::__allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<duckdb::DataTable, std::allocator<duckdb::DataTable>, (__gnu_cxx::_Lock_policy)2> > >(std::allocator<std::_Sp_counted_ptr_inplace<duckdb::DataTable, std::allocator<duckdb::DataTable>, (__gnu_cxx::_Lock_policy)2> >&) /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/allocated_ptr.h:97:21
    #4 0x39a00c9 in std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count<duckdb::DataTable, std::allocator<duckdb::DataTable>, duckdb::ClientContext&, duckdb::DataTable&, duckdb::ColumnDefinition&, duckdb::Expression*>(duckdb::DataTable*&, std::_Sp_alloc_shared_tag<std::allocator<duckdb::DataTable> >, duckdb::ClientContext&, duckdb::DataTable&, duckdb::ColumnDefinition&, duckdb::Expression*&&) /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/shared_ptr_base.h:677:19
    #5 0x399fd04 in std::__shared_ptr<duckdb::DataTable, (__gnu_cxx::_Lock_policy)2>::__shared_ptr<std::allocator<duckdb::DataTable>, duckdb::ClientContext&, duckdb::DataTable&, duckdb::ColumnDefinition&, duckdb::Expression*>(std::_Sp_alloc_shared_tag<std::allocator<duckdb::DataTable> >, duckdb::ClientContext&, duckdb::DataTable&, duckdb::ColumnDefinition&, duckdb::Expression*&&) /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/shared_ptr_base.h:1344:14
    #6 0x399f610 in std::shared_ptr<duckdb::DataTable>::shared_ptr<std::allocator<duckdb::DataTable>, duckdb::ClientContext&, duckdb::DataTable&, duckdb::ColumnDefinition&, duckdb::Expression*>(std::_Sp_alloc_shared_tag<std::allocator<duckdb::DataTable> >, duckdb::ClientContext&, duckdb::DataTable&, duckdb::ColumnDefinition&, duckdb::Expression*&&) /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/shared_ptr.h:359:4
    #7 0x399ee7a in std::shared_ptr<duckdb::DataTable> std::allocate_shared<duckdb::DataTable, std::allocator<duckdb::DataTable>, duckdb::ClientContext&, duckdb::DataTable&, duckdb::ColumnDefinition&, duckdb::Expression*>(std::allocator<duckdb::DataTable> const&, duckdb::ClientContext&, duckdb::DataTable&, duckdb::ColumnDefinition&, duckdb::Expression*&&) /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/shared_ptr.h:701:14
    #8 0x3929fd3 in std::shared_ptr<duckdb::DataTable> std::make_shared<duckdb::DataTable, duckdb::ClientContext&, duckdb::DataTable&, duckdb::ColumnDefinition&, duckdb::Expression*>(duckdb::ClientContext&, duckdb::DataTable&, duckdb::ColumnDefinition&, duckdb::Expression*&&) /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/shared_ptr.h:717:14
    #9 0x3919319 in duckdb::TableCatalogEntry::AddColumn(duckdb::ClientContext&, duckdb::AddColumnInfo&) /root/duckdb/src/catalog/catalog_entry/table_catalog_entry.cpp:209:6
    #10 0x391198c in duckdb::TableCatalogEntry::AlterEntry(duckdb::ClientContext&, duckdb::AlterInfo*) /root/duckdb/src/catalog/catalog_entry/table_catalog_entry.cpp:122:10
    #11 0x39d0ce4 in duckdb::CatalogSet::AlterEntry(duckdb::ClientContext&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, duckdb::AlterInfo*) /root/duckdb/src/catalog/catalog_set.cpp:172:22
    #12 0x38fe597 in duckdb::SchemaCatalogEntry::Alter(duckdb::ClientContext&, duckdb::AlterInfo*) /root/duckdb/src/catalog/catalog_entry/schema_catalog_entry.cpp:223:12
    #13 0x39eca94 in duckdb::Catalog::Alter(duckdb::ClientContext&, duckdb::AlterInfo*) /root/duckdb/src/catalog/catalog.cpp:375:24
    #14 0x8a245ae in duckdb::PhysicalAlter::GetData(duckdb::ExecutionContext&, duckdb::DataChunk&, duckdb::GlobalSourceState&, duckdb::LocalSourceState&) const /root/duckdb/src/execution/operator/schema/physical_alter.cpp:29:10
    #15 0xbb11e6 in duckdb::PipelineExecutor::FetchFromSource(duckdb::DataChunk&) /root/duckdb/src/parallel/pipeline_executor.cpp:316:19
    #16 0xb8fec8 in duckdb::PipelineExecutor::ExecutePull(duckdb::DataChunk&) /root/duckdb/src/parallel/pipeline_executor.cpp:194:5
    #17 0xb8eac0 in duckdb::Executor::FetchChunk() /root/duckdb/src/parallel/executor.cpp:698:18
    #18 0x76dbad in duckdb::ClientContext::FetchInternal(duckdb::ClientContextLock&, duckdb::Executor&, duckdb::BaseQueryResult&) /root/duckdb/src/main/client_context.cpp:99:25
    #19 0x779078 in duckdb::ClientContext::FetchResultInternal(duckdb::ClientContextLock&, duckdb::PendingQueryResult&, bool) /root/duckdb/src/main/client_context.cpp:230:16
    #20 0x79635c in duckdb::PendingQueryResult::ExecuteInternal(duckdb::ClientContextLock&, bool) /root/duckdb/src/main/pending_query_result.cpp:55:25
    #21 0x797a91 in duckdb::ClientContext::ExecutePendingQueryInternal(duckdb::ClientContextLock&, duckdb::PendingQueryResult&, bool) /root/duckdb/src/main/client_context.cpp:703:15
    #22 0x6a74ad in duckdb::ClientContext::Query(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, bool) /root/duckdb/src/main/client_context.cpp:642:21
    #23 0x6ac75f in duckdb::Connection::Query(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) /root/duckdb/src/main/connection.cpp:67:25
    #24 0x5b764e in duckdb_query /root/duckdb/src/main/capi/duckdb-c.cpp:67:22
    #25 0x59cdc3 in run_one_statement_new(void*, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) /mnt/jingzhou_workspace/sqlsim/client_new/duckdb/client_new.cpp:68:13
    #26 0x57b433 in run_testcase(void*&, char const*, int) /root/autodriver.cpp:135:14
    #27 0x57f845 in do_fuzz()::$_3::operator()() const /root/autodriver.cpp:295:13
    #28 0x57ff53 in main /root/autodriver.cpp:365:9
    #29 0x7fc34c01b082 in __libc_start_main /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308:16

SUMMARY: AddressSanitizer: heap-use-after-free /usr/lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/bits/atomic_base.h:419:9 in std::__atomic_base<bool>::load(std::memory_order) const
Shadow bytes around the buggy address:
  0x0c227fffd070: fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c227fffd080: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c227fffd090: fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa
  0x0c227fffd0a0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd
  0x0c227fffd0b0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
=>0x0c227fffd0c0:[fd]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c227fffd0d0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c227fffd0e0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c227fffd0f0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd
  0x0c227fffd100: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c227fffd110: fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
==16281==ABORTING
